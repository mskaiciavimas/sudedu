<!DOCTYPE html>
<html>

<head>
	<title>sudEdu - Mintinis Skai&#x10D;iavimas</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, interactive-widget=resizes-content">
	<link rel="icon" href="../../images/favicon.ico" type="image/x-icon">
	<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
	<link href="https://fonts.googleapis.com/css2?family=Andika:wght@400;700&family=Josefin+Sans&display=swap"
		rel="stylesheet">
	<link id="questionsStyleSheet" rel="stylesheet" type="text/css" href="../../questions-bigger.css">
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-96Q83PW8XY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-96Q83PW8XY');
</script>	

<body>
	<div class="container content" id="template-container"
		style="display: flex; flex-direction: column; justify-content: space-between;" hidden>
		<div class="row d-flex align-items-start">
			<div class="col-10 d-flex">
				<div class="trackers">
					<div>
						<h3 id="answer-tracker"></h3>
					</div>
					<div>
						<h3 id="mistake-tracker"></h3>
					</div>
				</div>
			</div>
			<div class="col-2 d-flex justify-content-end">
				<h3>
					<div id="timer"></div>
				</h3>
			</div>
		</div>

		<div class="row d-flex align-items-center justify-content-center">
			<div class="col-6 upper-line d-flex justify-content-center align-items-center">
				<p class="previous-equation">
			</div>
			<div id='middle-line' class="row middle-line d-flex align-items-center justify-content-center justify-content: space-between;">
				<div class="row" id="invisibleRow" style="display: none; height: 0;"></div>
				<div class="row" id="body-row" class="col12 d-flex justify-content-center align-items-center">
					<div id='content-container' class="col12 d-flex justify-content-center align-items-center equation-and-answer">
						<div id="equation-and-symbol">
						<div id="arithmetic-symbol"></div>
						<label id="equation" class="equation text-nowrap" for="answer-field"></label>
					</div>
						<div id="answer-separator-1" style="display: none;"></div>
							<div id="stulpeliu-div" class="d-flex justify-content-center align-items-center">
								
							</div>

						<div id="answer-separator-2"></div>

						<div class="answer-field-div">
							<div id="stulp-div-ans-and-first" class="d-flex justify-content-center align-items-center">
							<div id="division-stulp-1"></div>
							<div id="answer-field" class="answer-field">
								<input type="text" id="answer" name="answer" class="form-control text-center answer-input"
									placeholder="" autofocus autocomplete="off" style="display: none;">
							</div>
						</div>
							<div id="division-stulp-2"></div>

							<div id="remainder-field" class="remainder-field">
								<input type="text" id="remainder" name="remainder" class="form-control text-center remainder-input"
									placeholder="liek." autocomplete="off">
							</div>


					</div>
							<label class="equation_2 text-nowrap" for="answer-field" style="display: none;"></label>
					</div>
				</div>

				<div id="submit-button-row" class="row" style="display: none;">
					<div class="col-12 submit-button-div d-flex justify-content-center align-items-center">
						<div class="d-flex justify-content-start align-items-center">
							<button class="btn btn-primary question-submit-button">Tikrinti</button>
						</div>
					</div>
				</div>

				<div id="restart-reset-button-row" class="row justify-content-center align-items-center" style="display: none;">
					<div class="col-12 submit-button-div d-flex justify-content-center align-items-center">
						<div id="reset-mistake-buttons" class="col-12 d-flex justify-content-center align-items-center">
								<div id="fireworks-div" class="position-absolute image-container bottom-0 end-0 fireworks-div"></div>
							<div class="col-12 d-flex position-relative justify-content-center align-items-center">
								<div class="d-flex justify-content-end align-items-center summary-div">
									<button class="btn btn-primary summary-button">Klaidos</button>
								</div>

							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="row d-flex d-flex align-items-end justify-content-center stop-reset-button-div">
			<div class="col-2">
				<div class="stop-button-div">
					<button id="stopButton" class="btn btn-primary stop-button"><span id="stop-button-span"
						class="material-symbols-rounded">close</span></button>
				</div>
			</div>
			<div class="col-8"></div>
			<div class="col-2">
				<div class="reset-button-div">
					<button class="btn btn-primary reset-button"><span class="material-symbols-rounded">roofing</span></button>
				</div>
			</div>
		</div>
	</div>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
		crossorigin="anonymous"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/mobile-detect@1.4.6/dist/mobile-detect.min.js"></script>
	<script src="../../mental-arithmetic.js"></script>
	<script src="../../mental-arithmetic-combinations.js"></script>

	<script>

let helpTimeout;

function updateHelpTextForControl(controlId) {
    // Update the help text for the focused control
}

function setDefaultHelpText() {
    // Set the default help text
}

document.querySelectorAll('.control').forEach(control => {
    control.addEventListener('focusin', function() {
        // Clear any pending timeout to reset help text
        clearTimeout(helpTimeout);

        // Update the help text for this control
        updateHelpTextForControl(this.id);
    });

    control.addEventListener('focusout', function() {
        // Set a delay before resetting to the default help text
        helpTimeout = setTimeout(setDefaultHelpText, 100); // adjust delay as needed
    });
});

		const answerFieldDivElement = document.querySelector('.answer-field-div')

		const resetButtonElement = document.querySelector('.reset-button');
		resetButtonElement.addEventListener("click", redirectToIndex);

		const mistakesButtonElement = document.querySelector('.summary-button');
		mistakesButtonElement.addEventListener("click", () => {
			localStorage.setItem("elapsedTime", timerDisplay.textContent);
		})
		mistakesButtonElement.addEventListener("click", redirectToSummary);

		const resetMistakeButtonsElement = document.querySelector('#restart-reset-button-row');
		const stopButtonElement = document.querySelector('.stop-button');
		stopButtonElement.addEventListener("click", stopEquations)

		const linkElement = document.querySelector("#questionsStyleSheet");

		document.querySelector('.reset-button').addEventListener("click", redirectToIndex);

		mistakesButtonElement.addEventListener("click", () => {
			localStorage.setItem("elapsedTime", timerDisplay.textContent);
		})
		mistakesButtonElement.addEventListener("click", redirectToSummary);


		let equationElement = document.querySelector(".equation");
		let equation2Element = document.querySelector(".equation_2");

		function stylePage () {
		if (controller.modeChoice7 === 'stulpeliu' && controller.randomSelection[2] !== 'division') {
				linkElement.setAttribute("href", "../../questions-stulpeliu.css");

		} else if (controller.modeChoice7 === 'stulpeliu' && controller.randomSelection[2] === 'division') {
				linkElement.setAttribute("href", "../../questions-stulpeliu-div.css");

		} else if (controller.modeChoice7 === 'stulpeliu') {
			linkElement.setAttribute("href", "../../questions-stulpeliu.css");
		} else if (controller.withRemainder) {
						linkElement.setAttribute("href", "../../questions-remainder.css");
				} else {
				if (controller.modeChoice2 === "mil" ||
						controller.modeChoice2 === "iki1000000"
					)	{
						linkElement.setAttribute("href", "../../questions-extra-small.css");
				} else if (controller.modeChoice2 === "tukst" || 
						controller.modeChoice2 === "dtukst" || 
						controller.modeChoice2 === "iki1000" || 
						controller.modeChoice2 === "iki10000" || 
						controller.modeChoice2 === "pil10" || 
						controller.modeChoice2 === "pil100" ||
						controller.modeChoice2 === "pil" ||
						controller.modeChoice2 === "daugtrivien" ||
						controller.modeChoice2 === "daugketvien" ||
					  controller.modeChoice2 === "daugdvidvi" ||
						controller.modeChoice2 === "daugtridvi" ||
						controller.modeChoice2 === "daugketdvi" ||
						controller.modeChoice2 === "daugdaug" ||
						controller.modeChoice2 === "gretnul"
					) {
						linkElement.setAttribute("href", "../../questions-smaller.css");
				} else {
					linkElement.setAttribute("href", "../../questions-bigger.css");
				}
		}
	}

		window.onload = function () {
			if (localStorage.getItem('controller') === null) {
        window.location.href = "./";
    } else {
			controller = JSON.parse(localStorage.getItem('controller')) 
			if (controller.mode !== "math" || controller.language !== "LT") {
			window.location.href = "./";
			}
		}
    
    document.querySelector('#template-container').removeAttribute('hidden');
    controller = JSON.parse(localStorage.getItem('controller'));
    
		if (!controller.questionsStopped) {
    if (controller.modeChoice4 === 'timer') {
        countDown();
    } else if (controller.modeChoice4 === 'questionNumber') {
        startTimer();
    }
		}
    
    formEquation();
    displayEquation();
    
    if (!controller.questionsStopped) {
			answerInputElement.style.display = "flex";
			questionsSubmitButtonRowElement.style.display = "flex";
    } else {
			resetMistakeButtonsElement.style.display = "flex";
        document.querySelector('.answer-field-div').style.display = "none";
		const stopButtonSpanElement = document.querySelector('#stop-button-span');
		stopButtonSpanElement.innerHTML = "refresh";
        timerDisplay.textContent = localStorage.getItem("elapsedTime");
    }
    stylePage();
};

let answerInputElement = document.querySelector('#answer');
		answerInputElement.setAttribute("inputmode", "numeric");

let answerRemainderInputElement = document.querySelector('#remainder');
		answerRemainderInputElement.setAttribute("inputmode", "numeric");

		// Sanitize input field value on input event
		answerInputElement.addEventListener("input", function (event) {
			const sanitizedValue = event.target.value.replace(/[^0-9]/g, '');
			event.target.value = sanitizedValue;
		});

		answerRemainderInputElement.addEventListener("input", function (event) {
			const sanitizedValue = event.target.value.replace(/[^0-9]/g, '');
			event.target.value = sanitizedValue;
		});

		// Add event listener to checkAnswer function with condition
		let questionsSubmitButtonElement = document.querySelector('.question-submit-button')
		let questionsSubmitButtonRowElement = document.querySelector('#submit-button-row')
		questionsSubmitButtonElement.addEventListener("click", function () {
			if (answerInputElement.value.trim() !== "") {
				checkAnswer();
				clearAnswerField();
			}
			if (answerRemainderInputElement.value.trim() !== "") {
				checkAnswer();
				clearAnswerField();
			}
		});

		// Handle "Enter" key press with condition
		answerInputElement.addEventListener("keydown", function (event) {
			if (event.key === "Enter") {
				if (answerInputElement.value.trim() !== "") {
					checkAnswer();
					clearAnswerField();
				}
			}
		});
		answerRemainderInputElement.addEventListener("keydown", function (event) {
			if (event.key === "Enter") {
				if (answerRemainderInputElement.value.trim() !== "") {
					checkAnswer();
					clearAnswerField();
				}
			}
		});

		function clearAnswerField() {
			if (!isStulpeliu()) {
				answerInputElement.value = '';
				answerRemainderInputElement.value = '';
			} else if (isStulpeliu() && controller.result[0] === 'Correct') {
				answerInputElement.value = '';
				answerRemainderInputElement.value = '';
			}
		}

		function isStulpeliu() {
			if (controller.modeChoice7 === 'stulpeliu') {
				return true;
			} else {
				return false;
			}
		}

	// Function to set the margin of element2
	function setMargins() {

		const fontSIzeFull = 3;
		const oneRem = 16;
		const inputPadding = 20;
		var digitNumber = controller.randomSelection[1].toString();


		var element1 = document.getElementById('equation');
		var element2 = document.getElementById('answer-field');
		var element3 = document.querySelector('#stulpeliu-0');
		var element1Rect = element1.getBoundingClientRect();
		var computedStyle = window.getComputedStyle(element1);
		var paddingRight = parseFloat(computedStyle.paddingRight);
		var viewportWidth = window.innerWidth;
		var rightMargin = viewportWidth - (element1Rect.right + paddingRight);
		var answerSeparator1 = document.getElementById('answer-separator-1');
		var answerSeparator2 = document.getElementById('answer-separator-2');
		var computedStyle3;
		var leftMargin3;
		var equationElement = document.getElementById('equation');
		var equationElementWidth = equationElement.offsetWidth;
		var stulpeliuInput = document.getElementsByClassName('stulpeliu-input');
		var newWidth = 0;
		var firstElementRight = 0;
		var lastElementLeft = 0;
		var firstElmenetMarginRight = 0;
		var contentContainerElement = document.getElementById('content-container');
		var newMargin = 0
		var answerDigits = 0;

		
		function positionContentContainer () {
					contentContainerElement.style.width = 'auto';
					var middleLineWidth = document.getElementById('middle-line').offsetWidth;
					var contentContainerElementWidth = contentContainerElement.offsetWidth;
					var contentContainerMargins = (middleLineWidth - contentContainerElementWidth) / 2;
					const element2ComputedStyles = window.getComputedStyle(element2);
					const element2marginRight =  parseInt(element2ComputedStyles.getPropertyValue("margin-right"), 10) / 2;
					contentContainerElement.style.marginRight = contentContainerMargins - element2marginRight + 'px';
					contentContainerElement.style.marginLeft = contentContainerMargins + element2marginRight + 'px';
			}

		contentContainerElement.style.width = '100%';
		contentContainerElement.style.marginRight = 0 + 'px';
		contentContainerElement.style.marginLeft = 0 + 'px';

	if (controller.randomSelection[2] === 'multiplication') {
		for (var i = 0; i < stulpeliuInput.length; i++) {
			var stulpeliuInputElement = stulpeliuInput[i];
			newWidth = equationElementWidth + oneRem*1.75 + 2;
			stulpeliuInputElement.style.width = newWidth + "px";
			newMargin = oneRem*1.75;
			stulpeliuInputElement.style.marginRight = newMargin + 'px';

			if (i === 0) {
				var firstElement = document.getElementById(`stulpeliu-field-${i}`);
				var firstElement1Rect = firstElement.getBoundingClientRect();
				firstElementRight = firstElement1Rect.right + newMargin;
				firstElmenetMarginRight = newMargin;
				answerSeparator1.style.marginRight = newMargin + 'px';
				answerSeparator1.style.width = newWidth + 'px';
			} else if (i === stulpeliuInput.length-1) {
				var lastElement = document.getElementById(`stulpeliu-field-${i}`);
				var lastElement1Rect = firstElement.getBoundingClientRect();
				lastElementLeft = lastElement1Rect.left;
			}
		}

		if (element3) {
			antrasDaugiklisLength = (document.getElementById("antras-daugiklis").textContent).toString().length;
			var adjuster = 0;

			if (antrasDaugiklisLength > 3) {
				adjuster = antrasDaugiklisLength - 3
			}

			element2.style.width = firstElementRight + 28*adjuster - lastElementLeft + 'px';
			var answerFieldWidth = element2.offsetWidth;
			element2.style.marginRight = firstElmenetMarginRight + (answerFieldWidth - newWidth) + 'px';
			answerSeparator2.style.width = firstElementRight + 28*adjuster - lastElementLeft + 'px';
			answerSeparator2.style.marginRight = firstElmenetMarginRight + (answerFieldWidth - newWidth) + 'px';
			
		} else {

			var daugikliai = document.getElementsByClassName('daugiklis');
			var didDaugiklisWidth = 0;
			var didDaugiklis;

			for (var i = 0; i < daugikliai.length; i++) {
					didDaugiklisWidth = Math.max(didDaugiklisWidth, daugikliai[i].offsetWidth);
			}

			var answerDigits = (controller.randomSelection[0] * controller.randomSelection[1]).toString().length;
			didDaugiklis = Math.max(controller.randomSelection[0], controller.randomSelection[1]);

			daugiklisDigits = didDaugiklis.toString().length;
			element2.style.width = didDaugiklisWidth + oneRem*1.75 + oneRem*1.75*(answerDigits - daugiklisDigits) + 'px';
			element2.style.marginRight = oneRem*1.75*(answerDigits - daugiklisDigits) + 3 + 'px';
			answerSeparator2.style.width = didDaugiklisWidth + oneRem*1.75 + oneRem*1.75*(answerDigits - daugiklisDigits) + 'px';
			answerSeparator2.style.marginRight = oneRem*1.75*(answerDigits - daugiklisDigits) + 3 + 'px';
		}
		
		if (!controller.questionsStopped) {
			positionContentContainer();
		}

	} else if (controller.randomSelection[2] === 'division') {
		var dalinysElement = document.getElementById('dalinys');
		var daliklisElemet = document.getElementById('daliklis');
		var divisionResultDigits = (Math.floor(controller.randomSelection[0] / controller.randomSelection[1])).toString().length
		var daliklisDigits = controller.randomSelection[1].toString().length
		var dalinysElementWidth = dalinysElement.offsetWidth;
		var stulpeliu0 = document.getElementById('stulpeliu-0');
		var stulpeliu0Element = document.getElementById('stulpeliu-field-0');

		var stulpeliu0ComputedStyle = window.getComputedStyle(stulpeliu0Element);
		var stulpeliu0MarginLeft = stulpeliu0ComputedStyle.getPropertyValue('margin-left');
		stulpeliu0.style.width = dalinysElementWidth + 10 + "px";
		stulpeliu0.style.marginRight = 0 + 'px';

		var daliklisElement = document.getElementById('daliklis');
		var stulpeliu0 = document.getElementById('stulpeliu-0');
		modifier = 0;
		if ((Math.floor(controller.randomSelection[0] / controller.randomSelection[1])).toString().length < 2) {
			modifier = 1;
		}
		element2.style.width = oneRem*1.75*(divisionResultDigits) + oneRem*1.75 + 4 + "px";
		daliklisElemet.style.width = oneRem*1.75*(divisionResultDigits) + oneRem*1.75 + "px";
		element2.style.marginRight = oneRem*1.75*modifier + 4 + 'px';
		answerSeparator2.style.marginRight = oneRem*1.75*modifier + 4 + 'px';
		var daliklisElementWidth = daliklisElement.offsetWidth;


		if (stulpeliu0MarginLeft !== "0px") {
    const marginValue = (fontSIzeFull * oneRem * 1.15) / 2 + 'px';
    dalinysElement.style.marginLeft = marginValue;
    daliklisElement.style.marginLeft = marginValue;
		} else {
				dalinysElement.style.marginLeft = "px";
				daliklisElement.style.marginLeft = "px";
		}

		var counter = 0;
		var invisibleDivs = document.getElementsByClassName('invisibleDiv');
		for (var i = 0; i < invisibleDivs.length; i++) {
				var invisibleDivElement = invisibleDivs[i];
				invisibleDivElement.style.width = (daliklisElementWidth + 4) + "px";
		}

		var stulpeliuField = document.getElementsByClassName('stulpeliu-field-sub');
		for (var i = 0; i < stulpeliuField.length; i++) {
			var stulpeliuFieldElement = stulpeliuField[i];

			stulpeliuFieldElement.style.width = dalinysElementWidth + 10 + "px";
		}
		var stulpeliuField = document.getElementsByClassName('stulpeliu-field-sub');
		var lastStulpeliuField = stulpeliuField[stulpeliuField.length - 1];

		var computedStyle = window.getComputedStyle(lastStulpeliuField);
		var lastStulpeliuFieldMarginLeft = parseFloat(computedStyle.getPropertyValue('margin-left')); 

		} else {

			var demAtTur = document.getElementsByClassName('demuo-turinys-ateminys');
			var didDemAtTurWidth = 0;
			var didDemAtTur;

			for (var i = 0; i < demAtTur.length; i++) {
					didDemAtTurWidth = Math.max(didDemAtTurWidth, demAtTur[i].offsetWidth);
			}

			var answerSize = 0;
			var marginSize = 0;
			if (controller.randomSelection[2] === 'addition') {
				answerSize = didDemAtTurWidth + oneRem*1.75 * 2;
				marginSize = oneRem*1.75 + 3;
				positionContentContainer();
			} else if (controller.randomSelection[2] === 'subtraction') {
				answerSize = didDemAtTurWidth + oneRem*1.75;
				marginSize = 3;
			}

			element2.style.width = answerSize + 'px'
			element2.style.marginRight = marginSize + 'px';
			answerSeparator2.style.width = answerSize + 'px'
			answerSeparator2.style.marginRight = marginSize + 'px';

		}

		if (controller.withRemainder && controller.randomSelection[2] === 'division') {
    var liekElement = document.getElementById("liek");
    liekElement.style.visibility = "visible";
  }

		contentContainerElement.style.visibility = 'visible';
	}

// Run the function when the page is loaded
window.addEventListener('load', function() {

	if (controller.modeChoice7 === 'stulpeliu') {
		if (!controller.questionsStopped) {
    setTimeout(function() {
        setMargins();
    }, 500);
	}
}
});


// Run the function every time the page is resized
window.addEventListener('resize', function() {
	if (controller.questionsStopped) {
	setFontSize();
	}
	if (controller.modeChoice7 === 'stulpeliu') {
		if (!controller.questionsStopped) {
        setMargins();
	}
}
});

window.addEventListener("beforeunload", () => {
    controller.taskId = 0;
    localStorage.setItem("controller", JSON.stringify(controller));
});

	</script>
</body>

</html>
