<!DOCTYPE html>
<html>

<head>
	<title>Mintinis Skai&#x10D;iavimas</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="sudEdu skirtas priešmokyklinio ugdymo, pradinių bei aukštesnių klasių mokinių aritmetinių veiksmų (sudėties, atimties, daugybos, dalybos) mintinio skaičiavimo, teksto suvokimo ir rašybos įgūdžių tobulinimui.">
	<meta name="keywords" content="mintinis skaičiavimas, mintinas skaičiavimas, skaičiavimas mintinai, matematika, pradinukai, priešmokyklinis ugdymas, priešmokyklinukai, pradinis ugdymas, atminties lavinimas, skaitinė lygybė, skaitinė lygybė su nežinomuoju, sudėtis, dėmuo, atimtis, turinys, atėminys, daugyba, dauginamasis, daugiklis, dalyba, dalinis, daliklis, daugybos lentelė, lentelinė sudėtis, lentelinė atimtis, sudėtis iki 10, sudėtis iki 20, sudėtis iki 100, sudėtis iki 1000, atimtis iki 10, atimtis iki 20, atimtis iki 100, atimtis iki 1000, vienaženkliai skaičiai, dviženkliai skaičiai, triženkliai skaičiai, keturženkliai skaičiai, peržengiant dešimtį, peržengiant šimtą, peržengiant tūkstančių vienetus, išardant dešimtį, išardant šimtą, išardant tūkstančių vienetus, pergrupuojant dešimtis, pergrupuojant šimtus, peržengiant tūkstančių vienetus, rašyba, gramatika, rašinelis, teksto suvokimas, teksto komponavimas, tekso strūktura, teksto struktūros išdestymas, atnaujinta pradinio ugdymo programa">

	  <link rel="canonical" href="https://www.sudedu.lt/LT/">
	  <link rel="alternate" href="https://www.sudedu.lt/LT/" hreflang="lt">
	  <link rel="alternate" href="https://www.sudedu.lt/EN/" hreflang="en">
	<link rel="icon" href="../images/favicon.ico" type="image/x-icon">
	<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@400;700&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Andika:wght@400;700&family=Josefin+Sans&display=swap"
		rel="stylesheet">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
	<link rel="stylesheet" type="text/css" href="../index.css">
<style>
	.gap-after-row {
		padding-bottom: 10px;
	}

	#error {
		margin-bottom: 0;
	}

	input {
		min-width: 300px;
		padding: 5px;
	}

	#is-teacher {
		min-width: 0;
	}

	.btn:disabled {
            background-color: #B6C867;
            border-color: #B6C867;
            color: black;
            filter: grayscale(25%);
    }

	#error {
		max-width: 300px;
		min-height: 48px;

	}

	hr {
		margin: 32px 0 32px 0;
	}

</style>

</head>

<body>
	<div class="container d-flex align-items-center justify-content-between flex-column" id="template-container">
		<div class="invisible-spaceholder" style="height: 1px; width: 100%;"></div>
		<div>
		<div class="row">
		<div class="col-12">
			<h2 id="log-in-text">Log In</h2>
		</div>
		</div>

		<div class="col-12 gap-after-row">
			<p id="error"></p>
		</div>
		<div class="col-12 gap-after-row">
		<input id="emailInput" placeholder="email address" />
		</div>
		<div class="col-12 gap-after-row">
			<div style="position: relative;">
				<input id="passwordInput" placeholder="password" type="password" />
				<button type="button" onclick="togglePasswordVisibility()" 
				style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); border: none; background-color: transparent;">
				  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">
					<path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/>
					<path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/>
				  </svg>
				</button>
				</div>
		</div>
		<div class="col-12 gap-after-row">
			<input id="nickname" placeholder="name" />
		</div>
		<div class="col-12 gap-after-row"id="is-teacher-div">
				<input type="checkbox" id="is-teacher"/>
				I am a teacher
		</div>
		<div class="col-12 gap-after-row">
		<button class="btn btn-primary item-to-be-disabled-while-talking-to-server" id="authBtn" onclick="authenticate()">
			Log In
		</button>
		</div>
		<hr />
			<div class="col-12">
			<p id="sign-ip-text">Need an account?</p>
			</div>
			<div class="col-12">
			<button class="btn btn-primary item-to-be-disabled-while-talking-to-server" onclick="toggleIsRegister()" id="registerBtn">Sign Up</button>
		</div>
	</div>
	
	<div class="col-12 d-flex justify-content-end align-items-center">
		<div class="reset-button-div">
				<button class="btn btn-primary reset-button" onclick="redirectToIndex()"><span class="material-symbols-rounded">roofing</span></button>
		</div>
	</div>

	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
		crossorigin="anonymous"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="../mental-arithmetic.js"></script>
	<script src="../mental-arithmetic-combinations.js"></script>
	
	<script>
	function redirectToIndex() {
		localStorage.setItem('controller', JSON.stringify(controller))
		window.location.href = "./";
	}

	let userData = localStorage.getItem('userData');
	if (userData) {
		window.location.href = `/LT`;
	}

	document.querySelectorAll('.item-to-be-disabled-while-talking-to-server').forEach(el => el.disabled = false);

	const apiBase = 'https://sudedu-server.onrender.com/'

    const registerBtn = document.getElementById('registerBtn')
	const logInTitle = document.getElementById('log-in-text')
	const authBtn = document.getElementById('authBtn')
	const signUpText = document.getElementById('sign-ip-text')
	const email = document.getElementById('emailInput')
    const password = document.getElementById('passwordInput')
	const errorField = document.getElementById('error')
	const nickname = document.getElementById('nickname')
	const isTeacherDiv = document.getElementById('is-teacher-div')
	const isTeacher = document.getElementById('is-teacher')
	let isRegistration = false
	let isLoading = false
    let isAuthenticating = false

	nickname.style.display = 'none';
	isTeacherDiv.style.display = 'none';

	controller = JSON.parse(localStorage.getItem('controller'));

	if (controller.taskId !== 0 && controller.taskCompleted === true) {
		errorField.innerHTML = "Prisijunkite, kad rezultatai būtų išsaugoti."
	}

	async function toggleIsRegister() {
        isRegistration = !isRegistration
        registerBtn.innerText = isRegistration ? 'Log In' : 'Sign Up';
        logInTitle.innerHTML = isRegistration ? 'Sign Up' : 'Log In';
        signUpText.innerText = isRegistration ? 'Already have an account?' : 'Need an account?';
        authBtn.innerHTML = isRegistration ? 'Sign Up' : 'Log In';
		nickname.style.display = isRegistration ? 'block' : 'none';
		isTeacherDiv.style.display = isRegistration ? 'block' : 'none';
    }

	async function authenticate() {
		// access email and pass values
		const emailVal = email.value.trim();
		const passVal = password.value.trim();
		const nicknameVal = nickname.value.trim();
		const isTeacherVal = isTeacher.checked

		// guard clauses... if authenticating, return
		if (!emailVal) {
			errorField.innerHTML = 'Please type in your email address';
			return
		} else if (!passVal) {
			errorField.innerHTML = 'Please type in your password';
			return
		} else if ((passVal.length < 6 || passVal.length > 15) && isRegistration) {
			errorField.innerHTML = 'Password must be between 6 and 15 characters long';
			return
		} else if (!emailVal.includes('@')) {
			errorField.innerHTML = 'Invalid email address';
			return
		} else if (!nicknameVal && isRegistration) {
			errorField.innerHTML = 'Please type in your name';
			return
		} else if (nicknameVal.length > 15) {
			errorField.innerHTML = 'Name can only ne 15 characters long';
			return
		}
	
		if (
			isLoading ||
			isAuthenticating
		) { return }

		// reset error and set isAuthenticating to true
		errorField.innerHTML = ''
		isAuthenticating = true
		authBtn.innerText = 'Checking...'
		document.querySelectorAll('.item-to-be-disabled-while-talking-to-server').forEach(el => el.disabled = true);

		try {
			let data
			if (isRegistration) {
				// register an account
				const response = await fetch(apiBase + 'auth/register', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ username: emailVal, password: passVal, nickname: nicknameVal, isTeacher: isTeacherVal })
				})
				data = await response.json()
			} else {
				// login an account
				const response = await fetch(apiBase + 'auth/login', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ username: emailVal, password: passVal })
				})
				data = await response.json()
			}

			if (isRegistration && data.message == 'registration successful') {
				errorField.innerHTML = 'Account created successfully!';
				email.value = '';
    	 		password.value = '';
				nickname.value = '';
				isTeacher.checked = false;
				toggleIsRegister();
			} else if (data.token) {
				const userData = {
					token: data.token,
					userId: data.userId,
					nickname: data.nickname,
					accType: data.accType,
					teacher: data.teacher
				};

				localStorage.setItem('userData', JSON.stringify(userData));
				
				if (controller.taskId !== 0 && controller.taskCompleted === true) {
						if (controller.mode === "math") {
						window.location.href = `veiksmai.html`;
						} else if (controller.mode === "lang") {
							if (controller.modeChoice1 === "C49") {
								window.location.href = `teksto-suvokimas.html`;
							} else if (controller.modeChoice1 === "C50") {
								window.location.href = `rasyba.html`;
							}
						}
					} else {
						window.location.href = `/EN`;
					}
			} else {
				if (data.message == 'User not found') {
					errorField.innerHTML = 'User not found';
				} else if (data.message == 'Invalid password') {
					errorField.innerHTML = 'Invalid password';
				} else if (data.message = 'Username is already taken') {
					errorField.innerHTML = 'sername is already taken';
				} else if (data.message = 'Database is not available') {
					errorField.innerHTML = 'Database is not available. Try again later.';	
				} else if (data.message = 'Unexpected error') {
					errorField.innerHTML = 'Unexpected error. Try again later.';
				} else throw Error('Unexpected error')
			}
		} catch (err) {
			errorField.innerHTML = 'Database is not available. Try again later.';
			console.log('Error fetching tasks:', err);
		} finally {
			isAuthenticating = false
			if (isAuthenticating) {
				authBtn.innerText = 'Sign Up'
			} else {
				authBtn.innerText = 'Log In'
			}
			document.querySelectorAll('.item-to-be-disabled-while-talking-to-server').forEach(el => el.disabled = false);
		}
}

function togglePasswordVisibility() {
  const input = document.getElementById('passwordInput');
  input.type = input.type === 'password' ? 'text' : 'password';
}

	</script>
</body>

</html>
