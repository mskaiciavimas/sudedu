<!DOCTYPE html>
<html>

<head>
	<title>sudedu - matematika</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, interactive-widget=resizes-content">
	<link rel="icon" href="../images/favicon.ico" type="image/x-icon">
	<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
	<link href="https://fonts.googleapis.com/css2?family=Andika:wght@400;700&family=Josefin+Sans&display=swap"
		rel="stylesheet">
	<link rel="stylesheet" href="../main-nav-bar.css">
    <link rel="stylesheet" type="text/css" href="../index.css">
	<link id="questionsStyleSheet" rel="stylesheet" type="text/css" href="../questions-bigger.css">
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-96Q83PW8XY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-96Q83PW8XY');
</script>
<style>
	 * {
          -webkit-user-select: none;
          -webkit-tap-highlight-color: transparent;
          user-select: none;
          box-sizing: border-box;
          -webkit-user-drag: none;
          user-drag: none;
        }

      	html {
            display: flex;
            justify-content: center;
            align-items: center;
            background-image: linear-gradient(to top, #ffbf9c, #ffbf92, #ffbf89, #ffbf7e, #ffc074);
            width: 100vw;
            height: 100svh;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        body {
            margin: 0;
            font-family: 'SFpro', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

		.container {
			flex: 1;
			max-height: calc(100% - 80px - 16px - 16px);
			min-height: calc(100% - 80px - 16px - 16px);
			width: calc(100% - (2 * 16px));
			display: flex;
			justify-content: start;
			background: rgba(255, 255, 255, 0.08);
			margin: 16px;
			border-radius: 20px;
			border: 1px solid rgba(255, 255, 255, 0.1);
			flex-direction: column;
			padding: 20px;
		}

		.trackers-row {
          display: flex;
          flex-wrap: wrap;
		  justify-content: space-between;
        }

		.tracker-timer-holder {
          padding: 0 15px;
          margin-bottom: 10px;
        }

		.timer-holder {
			display: flex;
			justify-content: center;
		}

        #mistake-tracker,
        #answer-tracker,
        #timer {
          margin: 0;
          font-weight: 600;
          font-size: 1.25rem
        }

        #answer-tracker {
          margin-bottom: 5px;
        }

        .trackers-holder,
        .timer-holder {
          align-items: center;
        }

		.middle-and-upper-lines-holder {
			display: flex;
			flex: 1 1 auto;
			min-height: 0;
			overflow-y: auto;
		}

		.stop-reset-button-outer-div {
			padding-top: 15px;
			flex-shrink: 0;
			display: flex;
			justify-content: space-between;
		}

		#middle-line {
			display: flex;
			justify-content: center;
			align-items: center;
			flex: 1;
			min-height: 0;
			backdrop-filter: blur(15px);
			-webkit-backdrop-filter: blur(15px);
			background: rgba(255, 255, 255, 0.15);
			border-radius: 20px;
			overflow: hidden;
			width: 100%;
		}

		#middle-line-inner {
			width: 100%;
			height: 100%;
			display: flex;
			justify-content: center;
			align-items: center;
		}

		#content-container {
			height: 100%;
			width: 100%;
			display: flex;
			justify-content: center;
			align-items: center;
		}

		input,
		#answer {
			border-radius: 20px;
			background: rgba(255, 255, 255, 0.6);
			border: 1px solid rgba(255, 255, 255, 0.2);
			text-align: center;
			cursor: pointer;
		}

		input:focus,
		input:active,
		#answer:focus,
		#answer:active {
			border: 1px solid rgba(255, 255, 255, 1);
			background: rgba(255, 255, 255, 0.8);
			outline: none;
		}

		.equation,
		.equation_2,
		input {
			font-family: 'SFMono', sans-serif;
		}

		.stulpeliu-symbol-div {
			font-family: 'SFPro', sans-serif;
		}

		.answer-field-div,
		#stulp-div-ans-and-first {
			flex: 1 1 auto;
			min-height: 0;
		}


		.question-submit-button,
        #stopButton {
            position: relative;
            background: linear-gradient(135deg, #3288AC, #286D8A);
            border: none;
            /* border: 1px solid #286D8A; */
            color: #F5F5F7;
            display: flex;
            align-items: center;
            padding: 12px 18px 12px 18px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1rem;
            letter-spacing: 0.01em;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin: 0;
            justify-content: center;
            min-width: 10vw;
        }

        #stopButton {
          width: 6vw;
          min-width: 75px;
          height: 42.5px;
          border-radius: 100px;
          font-size: 2rem;
        }

		.question-submit-button::before,
        #stopButton::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0) 100%);
            border-radius: 20px;
            pointer-events: none;
            transition: background 0.3s ease;
        }

		.question-submit-button::after,
        #stopButton::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 20px;
            padding: 1px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
        }

		.question-submit-button:hover::before
        #stopButton:hover::before {
            background: rgba(255, 255, 255, 0.15);
        }

		.material-symbols-rounded {
			font-size: 2rem;
			font-weight: 300;
		}

	@media (max-width: 1150px) {
        .question-submit-button {
          min-width: 15vw;
        }
	}

	@media (max-width: 767px) {
		.container {
			width: 100%;
			max-height: calc(100% - 72px);
			min-height: calc(100% - 72px);
			margin: 0;
			background: transparent;
			border: none;
			border-radius: 0;
			padding: 15px;
		}

		.question-submit-button {
          min-width: 25vw;
        }
	}

	@media (min-device-width: 768px) and (max-device-width: 1200px) and (orientation: portrait)  {
		.stop-button {
			height: 6rem;
			width: 6rem;
		}

		.reset-button {
			height: 6rem;
			width: 6rem;	
		}

		.material-symbols-rounded {
			font-size: 4.5rem;
		}

		.summary-button {
			font-size: 1.5rem;
		}

		.question-submit-button {
			font-size: 1.5rem;
		}

		h3 {
			font-size: 2rem;
		}

		#task-saving-message {
			font-size: 1.75rem
		}

		.question-submit-button {
			font-size: 1.25rem;
			min-width: 25vw;
		}
	}
	
</style>	

<body>
	    <div id="customConfirmModal" class="modal">
    <div class="modal-content">
        <p id="customModalText"></p>
        <div class="modal-buttons">
        <button id="customConfirmYes" class="btn-confirm">Taip</button>
        <button id="customConfirmNo" class="btn-cancel">Ne</button>
        </div>
    </div>
    </div>


    <nav class="main-navbar" id="mainNavbar">
      <div class="main-nav-container">
          <!-- Logo -->
          <a href="#" class="main-nav-logo">
              <div class="main-nav-logo-icon">
                <img id="sudedu-main-nav-bar-logo" src="../images/sudedu_logo.png" alt="sudEdu">
              </div>
          </a>

          <!-- Desktop Navigation -->
          <div class="main-nav-links">
              <a href="praktika.html" class="main-nav-back-btn">
                    <span class="main-nav-back-icon">←</span>
                    <div class="main-nav-back-text">
                        <span class="main-nav-back-label">Grįžti į</span>
                        <span class="main-nav-back-title">Padžią</span>
                    </div>
                </a>
          </div>

                    <!-- Desktop Navigation -->
          <div class="main-nav-mobile-btn simplified">
              <a href="praktika.html" class="main-nav-back-btn">
                    <span class="main-nav-back-icon">←</span>
                    <div class="main-nav-back-text">
                        <span class="main-nav-back-label">Grįžti į</span>
                        <span class="main-nav-back-title">Padžią</span>
                    </div>
                </a>
          </div>
      </div>
  </nav>

	<div class="container content" id="template-container" style="" hidden>
		 <div class="tracker-timer-holder">
		<div class="trackers-row">
			<div class="trackers-holder">
				<div class="trackers">
					<div>
						<h3 id="answer-tracker"></h3>
					</div>
					<div>
						<h3 id="mistake-tracker"></h3>
					</div>
				</div>
		</div>
		<div class="timer-holder">
			<div id="timer"></div>
		</div>
		</div>
		</div>

		<div class="middle-and-upper-lines-holder">
			<div class="upper-line">
				<p class="previous-equation"></p>
			</div>
			<div id='middle-line' class="middle-line" style="position: relative;">
				<div id="fireworks-div" class="image-containerfireworks-div"></div>
				<div class="" id="invisibleRow" style="display: none; height: 0;"></div>
				<div class="" id="middle-line-inner" class="">
					<div id='content-container' class="equation-and-answer">
						<div id="equation-and-symbol">
							<div id="arithmetic-symbol"></div>
							<label id="equation" class="equation text-nowrap" for="answer-field"></label>
							<div id="task-saving-message"></div>
						</div>
						<div id="answer-separator-1" style="display: none;"></div>
							<div id="stulpeliu-div" class="">
								
							</div>

						<div id="answer-separator-2"></div>

						<div class="answer-field-div">
							<div id="stulp-div-ans-and-first" class="">
							<div id="division-stulp-2">
								<div id="division-stulp-2-outer">
								<div id="division-stulp-2-inner"></div>
								</div>
							</div>
							<div id="answer-field-outer">
							<div id="answer-field" class="answer-field">
								<input type="text" id="answer" name="answer" class="form-control text-center answer-input"
									placeholder="" autofocus autocomplete="off" style="display: none;">
							</div>
							</div>
						</div>

							<div id="remainder-field" class="remainder-field">
								<input type="text" id="remainder" name="remainder" class="form-control text-center remainder-input"
									placeholder="liek." autocomplete="off">
							</div>


					</div>
							<label class="equation_2 text-nowrap" for="answer-field" style="display: none;"></label>
					</div>
				</div>

				<div id="restart-reset-button-row" class="" style="display: none;">
					<div class="submit-button-div">
						<div id="reset-mistake-buttons" class="">
							<div class="">
								<div class="summary-div">
									<button class="btn btn-primary summary-button">Klaidos</button>
								</div>

							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="stop-reset-button-outer-div">



      <div class="stop-restart-button-row" id="stop-restart-button-row">
      <div class="stop-reset-button-div">
        <div class="">
          <div class="stop-button-div">
            <button id="stopButton" class="stop-button"><span id="stop-button-span" class="material-symbols-rounded">close</span></button>
          </div>
        </div>
      </div>
    </div>

    <div class="check-ans-button-holder">
				<div id="submit-button-row" class="row" style="display: none;">
					<div class="submit-button-div">
						<div class="d-flex justify-content-start align-items-center">
							<button class="question-submit-button">Tikrinti</button>
						</div>
					</div>
				</div>
  </div>





		</div>
	</div>
	<script src="../main-nav-bar.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/mobile-detect@1.4.6/dist/mobile-detect.min.js"></script>
	<script src="../mental-arithmetic.js"></script>
	<script src="../mental-arithmetic-combinations.js"></script>

	<script>

let helpTimeout;

function updateHelpTextForControl(controlId) {
    // Update the help text for the focused control
}

function setDefaultHelpText() {
    // Set the default help text
}

document.querySelectorAll('.control').forEach(control => {
    control.addEventListener('focusin', function() {
        // Clear any pending timeout to reset help text
        clearTimeout(helpTimeout);

        // Update the help text for this control
        updateHelpTextForControl(this.id);
    });

    control.addEventListener('focusout', function() {
        // Set a delay before resetting to the default help text
        helpTimeout = setTimeout(setDefaultHelpText, 100); // adjust delay as needed
    });
});

		const answerFieldDivElement = document.querySelector('.answer-field-div')

		const mistakesButtonElement = document.querySelector('.summary-button');
		mistakesButtonElement.addEventListener("click", () => {
			localStorage.setItem("elapsedTime", timerDisplay.textContent);
		})
		mistakesButtonElement.addEventListener("click", redirectToSummary);

		const resetMistakeButtonsElement = document.querySelector('#restart-reset-button-row');
		const stopButtonElement = document.querySelector('.stop-button');
		stopButtonElement.addEventListener("click", stopEquations)

		const linkElement = document.querySelector("#questionsStyleSheet");

		mistakesButtonElement.addEventListener("click", () => {
			localStorage.setItem("elapsedTime", timerDisplay.textContent);
		})
		mistakesButtonElement.addEventListener("click", redirectToSummary);


		let equationElement = document.querySelector(".equation");
		let equation2Element = document.querySelector(".equation_2");

		function stylePage () {
		if (controller.modeChoice7 === "C48" && controller.randomSelection[2] !== 'D') {
				linkElement.setAttribute("href", "../questions-stulpeliu.css");

		} else if (controller.modeChoice7 === "C48" && controller.randomSelection[2] === 'D') {
				linkElement.setAttribute("href", "../questions-stulpeliu-div.css");

		} else if (controller.modeChoice7 === "C48") {
			linkElement.setAttribute("href", "../questions-stulpeliu.css");
		} else if (controller.withRemainder) {
						linkElement.setAttribute("href", "../questions-remainder.css");
				} else {
				if (controller.modeChoice2 === "C15" ||
						controller.modeChoice2 === "C36"
					)	{
						linkElement.setAttribute("href", "../questions-extra-small.css");
				} else if (controller.modeChoice2 === "C13" || 
						controller.modeChoice2 === "C14" || 
						controller.modeChoice2 === "C34" || 
						controller.modeChoice2 === "C35" || 
						controller.modeChoice2 === "C28" || 
						controller.modeChoice2 === "C77" ||
						controller.modeChoice2 === "C29" ||
						controller.modeChoice2 === "C20" ||
						controller.modeChoice2 === "C21" ||
					  	controller.modeChoice2 === "C23" ||
						controller.modeChoice2 === "C24" ||
						controller.modeChoice2 === "C25" ||
						controller.modeChoice2 === "C26" ||
						controller.modeChoice2 === "C27" ||
						controller.modeChoice2 === "C16"
					) {
						linkElement.setAttribute("href", "../questions-smaller.css");
				} else {
					linkElement.setAttribute("href", "../questions-bigger.css");
				}
		}
	}

		window.onload = function () {
			if (localStorage.getItem('controller') === null) {
        window.location.href = "./";
    } else {
			controller = JSON.parse(localStorage.getItem('controller')) 
			if (controller.mode !== "math" || controller.language !== "LT") {
			window.location.href = "./";
			}
		}
    
    document.querySelector('#template-container').removeAttribute('hidden');
    controller = JSON.parse(localStorage.getItem('controller'));
    
		if (!controller.questionsStopped) {
    if (controller.modeChoice4 === "C39") {
        countDown();
    } else if (controller.modeChoice4 === "C40") {
        startTimer();
    }
		}
    
    formEquation();
    displayEquation();
    
    if (!controller.questionsStopped) {
			answerInputElement.style.display = "block";
			questionsSubmitButtonRowElement.style.display = "flex";
    } else {
			resetMistakeButtonsElement.style.display = "flex";
        document.querySelector('.answer-field-div').style.display = "none";
		const stopButtonSpanElement = document.querySelector('#stop-button-span');
		stopButtonSpanElement.innerHTML = "refresh";
        timerDisplay.textContent = localStorage.getItem("elapsedTime");
    }
    stylePage();
};

// Find the inputs and add the necessary attributes
let answerInputElement = document.querySelector('#answer');
answerInputElement.setAttribute("inputmode", "numeric");
answerInputElement.setAttribute("autocomplete", "off");
answerInputElement.setAttribute("autocorrect", "off");
answerInputElement.setAttribute("autocapitalize", "off");
answerInputElement.setAttribute("spellcheck", "false");
answerInputElement.setAttribute("data-form-type", "other");

let answerRemainderInputElement = document.querySelector('#remainder');
answerRemainderInputElement.setAttribute("inputmode", "numeric");
answerRemainderInputElement.setAttribute("autocomplete", "off");
answerRemainderInputElement.setAttribute("autocorrect", "off");
answerRemainderInputElement.setAttribute("autocapitalize", "off");
answerRemainderInputElement.setAttribute("spellcheck", "false");
answerRemainderInputElement.setAttribute("data-form-type", "other");

		// Sanitize input field value on input event
		answerInputElement.addEventListener("input", function (event) {
			const sanitizedValue = event.target.value.replace(/[^0-9]/g, '');
			event.target.value = sanitizedValue;
		});

		answerRemainderInputElement.addEventListener("input", function (event) {
			const sanitizedValue = event.target.value.replace(/[^0-9]/g, '');
			event.target.value = sanitizedValue;
		});

		// Prevent scroll on focus for all inputs
		document.querySelectorAll('input').forEach(input => {
			input.addEventListener('focus', function(e) {
				// Prevent default scroll behavior
				setTimeout(() => {
					this.scrollIntoView({ behavior: 'instant', block: 'nearest', inline: 'nearest' });
				}, 0);
			}, { passive: true });
		});

		// Prevent the division-stulp-2-outer from jumping
		const divisionStulpOuter = document.getElementById('division-stulp-2-outer');
		if (divisionStulpOuter) {
			const originalScrollTop = divisionStulpOuter.scrollTop;
			
			document.querySelectorAll('input').forEach(input => {
				input.addEventListener('focus', function() {
					requestAnimationFrame(() => {
						divisionStulpOuter.scrollTop = originalScrollTop;
					});
				});
			});
		}

		// Add event listener to checkAnswer function with condition
		let questionsSubmitButtonElement = document.querySelector('.question-submit-button')
		let questionsSubmitButtonRowElement = document.querySelector('#submit-button-row')
		questionsSubmitButtonElement.addEventListener("click", function () {
			if (answerInputElement.value.trim() !== "") {
				checkAnswer();
				clearAnswerField();
			}
			if (answerRemainderInputElement.value.trim() !== "") {
				checkAnswer();
				clearAnswerField();
			}
		});

		// Handle "Enter" key press with condition
		answerInputElement.addEventListener("keydown", function (event) {
			if (event.key === "Enter") {
				if (answerInputElement.value.trim() !== "") {
					checkAnswer();
					clearAnswerField();
				}
			}
		});
		answerRemainderInputElement.addEventListener("keydown", function (event) {
			if (event.key === "Enter") {
				if (answerRemainderInputElement.value.trim() !== "") {
					checkAnswer();
					clearAnswerField();
				}
			}
		});

		function clearAnswerField() {
			if (!isStulpeliu()) {
				answerInputElement.value = '';
				answerRemainderInputElement.value = '';
			} else if (isStulpeliu() && controller.result[0] === 'Correct') {
				answerInputElement.value = '';
				answerRemainderInputElement.value = '';
			}
		}

		function isStulpeliu() {
			if (controller.modeChoice7 === "C48") {
				return true;
			} else {
				return false;
			}
		}

		// Function to configure any input element
function configureInput(inputElement) {
    inputElement.setAttribute("autocomplete", "off");
    inputElement.setAttribute("autocorrect", "off");
    inputElement.setAttribute("autocapitalize", "off");
    inputElement.setAttribute("spellcheck", "false");
    inputElement.setAttribute("data-form-type", "other");
    inputElement.setAttribute("data-lpignore", "true");
    inputElement.setAttribute("data-1p-ignore", "true");
	inputElement.setAttribute("inputmode", "numeric");
    
    // Prevent scroll on focus
    inputElement.addEventListener('focus', function(e) {
        const divisionStulpOuter = document.getElementById('division-stulp-2-outer');
        const scrollPos = divisionStulpOuter ? divisionStulpOuter.scrollTop : 0;
        
        setTimeout(() => {
            this.scrollIntoView({ behavior: 'instant', block: 'nearest', inline: 'nearest' });
            if (divisionStulpOuter) {
                divisionStulpOuter.scrollTop = scrollPos;
            }
        }, 0);
    }, { passive: true });
}

// Apply to existing inputs
document.querySelectorAll('input').forEach(input => {
    configureInput(input);
});

// Use MutationObserver to catch dynamically added inputs
const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
        mutation.addedNodes.forEach((node) => {
            if (node.nodeType === 1) { // Element node
                if (node.tagName === 'INPUT') {
                    configureInput(node);
                }
                // Also check children
                node.querySelectorAll && node.querySelectorAll('input').forEach(input => {
                    configureInput(input);
                });
            }
        });
    });
});

// Start observing
observer.observe(document.body, {
    childList: true,
    subtree: true
});

	// Function to set the margin of element2
	function setMargins() {

		const fontSIzeFull = 3;
		const oneRem = 16;
		const inputPadding = 20;
		var digitNumber = controller.randomSelection[1].toString();


		var element1 = document.getElementById('equation');
		var element2 = document.getElementById('answer-field');
		var element3 = document.querySelector('#stulpeliu-0');
		var element1Rect = element1.getBoundingClientRect();
		var computedStyle = window.getComputedStyle(element1);
		var paddingRight = parseFloat(computedStyle.paddingRight);
		var viewportWidth = window.innerWidth;
		var rightMargin = viewportWidth - (element1Rect.right + paddingRight);
		var answerSeparator1 = document.getElementById('answer-separator-1');
		var answerSeparator2 = document.getElementById('answer-separator-2');
		var computedStyle3;
		var leftMargin3;
		var equationElement = document.getElementById('equation');
		var equationElementWidth = equationElement.offsetWidth;
		var stulpeliuInput = document.getElementsByClassName('stulpeliu-input');
		var newWidth = 0;
		var firstElementRight = 0;
		var lastElementLeft = 0;
		var firstElmenetMarginRight = 0;
		var contentContainerElement = document.getElementById('content-container');
		var newMargin = 0
		var answerDigits = 0;

		
		function positionContentContainer () {
			contentContainerElement.style.width = 'auto';
			var middleLineWidth = document.getElementById('middle-line').offsetWidth;
			var contentContainerElementWidth = contentContainerElement.offsetWidth;
			var contentContainerMargins = (middleLineWidth - contentContainerElementWidth) / 2;
			const element2ComputedStyles = window.getComputedStyle(element2);
			const element2marginRight =  parseInt(element2ComputedStyles.getPropertyValue("margin-right"), 10) / 2;
			contentContainerElement.style.marginRight = contentContainerMargins - element2marginRight + 'px';
			contentContainerElement.style.marginLeft = contentContainerMargins + element2marginRight + 'px';
		}

		contentContainerElement.style.width = '100%';
		contentContainerElement.style.marginRight = 0 + 'px';
		contentContainerElement.style.marginLeft = 0 + 'px';

	if (controller.randomSelection[2] === 'M') {
		for (var i = 0; i < stulpeliuInput.length; i++) {
			var stulpeliuInputElement = stulpeliuInput[i];
			newWidth = equationElementWidth + oneRem*1.75 + 2;
			stulpeliuInputElement.style.width = newWidth + "px";
			newMargin = oneRem*1.75;
			stulpeliuInputElement.style.marginRight = newMargin + 'px';

			if (i === 0) {
				var firstElement = document.getElementById(`stulpeliu-field-${i}`);
				var firstElement1Rect = firstElement.getBoundingClientRect();
				firstElementRight = firstElement1Rect.right + newMargin;
				firstElmenetMarginRight = newMargin;
				answerSeparator1.style.marginRight = newMargin + 'px';
				answerSeparator1.style.width = newWidth + 'px';
			} else if (i === stulpeliuInput.length-1) {
				var lastElement = document.getElementById(`stulpeliu-field-${i}`);
				var lastElement1Rect = firstElement.getBoundingClientRect();
				lastElementLeft = lastElement1Rect.left;
			}
		}

		if (element3) {
			antrasDaugiklisLength = (document.getElementById("antras-daugiklis").textContent).toString().length;
			var adjuster = 0;

			if (antrasDaugiklisLength > 3) {
				adjuster = antrasDaugiklisLength - 3
			}

			element2.style.width = firstElementRight + 28*adjuster - lastElementLeft + 'px';
			var answerFieldWidth = element2.offsetWidth;
			element2.style.marginRight = firstElmenetMarginRight + (answerFieldWidth - newWidth) + 'px';
			answerSeparator2.style.width = firstElementRight + 28*adjuster - lastElementLeft + 'px';
			answerSeparator2.style.marginRight = firstElmenetMarginRight + (answerFieldWidth - newWidth) + 'px';
			
		} else {

			var daugikliai = document.getElementsByClassName('daugiklis');
			var didDaugiklisWidth = 0;
			var didDaugiklis;

			for (var i = 0; i < daugikliai.length; i++) {
					didDaugiklisWidth = Math.max(didDaugiklisWidth, daugikliai[i].offsetWidth);
			}

			var answerDigits = (controller.randomSelection[0] * controller.randomSelection[1]).toString().length;
			didDaugiklis = Math.max(controller.randomSelection[0], controller.randomSelection[1]);

			daugiklisDigits = didDaugiklis.toString().length;
			element2.style.width = didDaugiklisWidth + oneRem*1.75 + oneRem*1.75*(answerDigits - daugiklisDigits) + 'px';
			element2.style.marginRight = oneRem*1.75*(answerDigits - daugiklisDigits) + 3 + 'px';
			answerSeparator2.style.width = didDaugiklisWidth + oneRem*1.75 + oneRem*1.75*(answerDigits - daugiklisDigits) + 'px';
			answerSeparator2.style.marginRight = oneRem*1.75*(answerDigits - daugiklisDigits) + 3 + 'px';
		}
		
		if (!controller.questionsStopped) {
			positionContentContainer();
		}

	} else if (controller.randomSelection[2] === 'D') {
		let answerInput = document.querySelector("#answer")
		let daliklis = document.querySelector("#daliklis")
		answerInput.style.width = `${(controller.randomSelection[0]/controller.randomSelection[1]).toString().length + 1.25}ch`;
		daliklis.style.width = `${(controller.randomSelection[0]/controller.randomSelection[1]).toString().length + 1.25}ch`;

		} else {

			var demAtTur = document.getElementsByClassName('demuo-turinys-ateminys');
			var didDemAtTurWidth = 0;
			var didDemAtTur;

			for (var i = 0; i < demAtTur.length; i++) {
					didDemAtTurWidth = Math.max(didDemAtTurWidth, demAtTur[i].offsetWidth);
			}

			var answerSize = 0;
			var marginSize = 0;
			if (controller.randomSelection[2] === 'A') {
				answerSize = didDemAtTurWidth + oneRem*1.75 * 2;
				marginSize = oneRem*1.75 + 3;
				positionContentContainer();
			} else if (controller.randomSelection[2] === 'S') {
				answerSize = didDemAtTurWidth + oneRem*1.75;
				marginSize = 3;
			}

			element2.style.width = answerSize + 'px'
			element2.style.marginRight = marginSize + 'px';
			answerSeparator2.style.width = answerSize + 'px'
			answerSeparator2.style.marginRight = marginSize + 'px';

		}

		if (controller.withRemainder && controller.randomSelection[2] === 'D') {
    var liekElement = document.getElementById("liek");
    liekElement.style.visibility = "visible";
  }

  		adjustMiddleLineHeight();
		contentContainerElement.style.visibility = 'visible';
	}

// Run the function when the page is loaded
window.addEventListener('load', function() {
	if (controller.questionsStopped) {
		setFontSize();
	}
	if (controller.modeChoice7 === "C48") {
		if (!controller.questionsStopped) {
    setTimeout(function() {
        setMargins();
    }, 500);
	}
}
});


// Run the function every time the page is resized
window.addEventListener('resize', function() {
	if (controller.questionsStopped) {
	setFontSize();
	}
	if (controller.modeChoice7 === "C48") {
		if (!controller.questionsStopped) {
        //setMargins();
	}
}
});

const el = document.getElementById('middle-line-inner');
const parent = el.parentElement;

function adjustMiddleLineHeight() {
  el.style.height = 'auto';
  el.style.height = el.scrollHeight <= parent.clientHeight ? 'auto' : '100%';
}

window.addEventListener('resize', adjustMiddleLineHeight);
adjustMiddleLineHeight();

window.addEventListener("beforeunload", () => {
	if (!redirectingToAuthentication) {
		controller.taskId = 0;
		controller.taskCompleted = false;
	}
	localStorage.setItem("controller", JSON.stringify(controller));
});


	</script>
</body>

</html>
