<!DOCTYPE html>
<html>

<head>
	<title>Mintinis Skai&#x10D;iavimas</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="sudEdu skirtas priešmokyklinio ugdymo, pradinių bei aukštesnių klasių mokinių aritmetinių veiksmų (sudėties, atimties, daugybos, dalybos) mintinio skaičiavimo, teksto suvokimo ir rašybos įgūdžių tobulinimui.">
	<meta name="keywords" content="mintinis skaičiavimas, mintinas skaičiavimas, skaičiavimas mintinai, matematika, pradinukai, priešmokyklinis ugdymas, priešmokyklinukai, pradinis ugdymas, atminties lavinimas, skaitinė lygybė, skaitinė lygybė su nežinomuoju, sudėtis, dėmuo, atimtis, turinys, atėminys, daugyba, dauginamasis, daugiklis, dalyba, dalinis, daliklis, daugybos lentelė, lentelinė sudėtis, lentelinė atimtis, sudėtis iki 10, sudėtis iki 20, sudėtis iki 100, sudėtis iki 1000, atimtis iki 10, atimtis iki 20, atimtis iki 100, atimtis iki 1000, vienaženkliai skaičiai, dviženkliai skaičiai, triženkliai skaičiai, keturženkliai skaičiai, peržengiant dešimtį, peržengiant šimtą, peržengiant tūkstančių vienetus, išardant dešimtį, išardant šimtą, išardant tūkstančių vienetus, pergrupuojant dešimtis, pergrupuojant šimtus, peržengiant tūkstančių vienetus, rašyba, gramatika, rašinelis, teksto suvokimas, teksto komponavimas, tekso strūktura, teksto struktūros išdestymas, atnaujinta pradinio ugdymo programa">

	  <link rel="canonical" href="https://www.sudedu.lt/LT/">
	  <link rel="alternate" href="https://www.sudedu.lt/LT/" hreflang="lt">
	  <link rel="alternate" href="https://www.sudedu.lt/EN/" hreflang="en">
	<link rel="icon" href="../images/favicon.ico" type="image/x-icon">
	<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@400;700&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Andika:wght@400;700&family=Josefin+Sans&display=swap"
		rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="/index.css">
<style>
	.gap-after-row {
		padding-bottom: 10px;
	}

</style>

</head>

<body>
	<div class="container d-flex align-items-center justify-content-center" id="template-container">
		<div class="col-12">
		<div class="row">
		<div class="col-12">
			<h2 id="log-in-text">Prisijungimas</h2>
		</div>
		</div>

		<div class="col-12 gap-after-row">
			<p id="error"></p>
		</div>
		<div class="col-12 gap-after-row">
		<input id="emailInput" placeholder="elektroninis paštas" />
		</div>
		<div class="col-12 gap-after-row">
		<input id="passwordInput" placeholder="slaptažodis" type="password" />
		</div>
		<div class="col-12 gap-after-row">
			<input id="nickname" placeholder="vardas" />
		</div>
		<div class="col-12 gap-after-row"id="is-teacher-div">
				<input type="checkbox" id="is-teacher"/>
				Aš esu mokytoja(as)
		</div>
		<div class="col-12 gap-after-row">
		<button id="authBtn" onclick="authenticate()">
			Prisijungti
		</button>
		</div>
		<hr />
			<div class="col-12">
			<p id="sign-ip-text">Neturi paskyros?</p>
			</div>
			<div class="col-12">
			<button onclick="toggleIsRegister()" id="registerBtn">Sukurti paskyrą</button>
		</div>
	</div>
	

	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
		crossorigin="anonymous"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="../mental-arithmetic.js"></script>
	<script src="../mental-arithmetic-combinations.js"></script>
	
	<script>

	let userData = localStorage.getItem('userData');
	if (userData) {
		window.location.href = `/LT/matematika/index.html`;
	}

	const apiBase = 'https://sudedu-server.onrender.com/'

    const registerBtn = document.getElementById('registerBtn')
	const logInTitle = document.getElementById('log-in-text')
	const authBtn = document.getElementById('authBtn')
	const signUpText = document.getElementById('sign-ip-text')
	const email = document.getElementById('emailInput')
    const password = document.getElementById('passwordInput')
	const errorField = document.getElementById('error')
	const nickname = document.getElementById('nickname')
	const isTeacherDiv = document.getElementById('is-teacher-div')
	const isTeacher = document.getElementById('is-teacher')
	let isRegistration = false
	let isLoading = false
    let isAuthenticating = false

	nickname.style.display = 'none';
	isTeacherDiv.style.display = 'none';

	async function toggleIsRegister() {
        isRegistration = !isRegistration
        registerBtn.innerText = isRegistration ? 'Prisijungti' : 'Sukurti paskyrą';
        logInTitle.innerHTML = isRegistration ? 'Registracija' : 'Prisijungimas';
        signUpText.innerText = isRegistration ? 'Jau turi paskyrą?' : 'Neturi paskyros?';
        authBtn.innerHTML = isRegistration ? 'Prisiregistruoti' : 'Prisijungti';
		nickname.style.display = isRegistration ? 'block' : 'none';
		isTeacherDiv.style.display = isRegistration ? 'block' : 'none';
    }

	async function authenticate() {
		// access email and pass values
		const emailVal = email.value
		const passVal = password.value
		const nicknameVal = nickname.value
		const isTeacherVal = isTeacher.checked

		// guard clauses... if authenticating, return
		if (!emailVal) {
			errorField.innerHTML = 'Įveskite elektroninį paštą';
			return
		} else if (!passVal) {
			errorField.innerHTML = 'Įveskite slaptažodį';
			return
		} else if ((passVal.length < 6 || passVal.length > 10) && isRegistration) {
			errorField.innerHTML = 'Slaptažodis turi būti nuo 6 iki 10 simbolių';
			return
		} else if (!emailVal.includes('@')) {
			errorField.innerHTML = 'Neteisingas elektroninio pašto formatas';
			return
		} else if (!nicknameVal && isRegistration) {
			errorField.innerHTML = 'Įveskite vardą';
			return
		}
	
		if (
			isLoading ||
			isAuthenticating
		) { return }

		// reset error and set isAuthenticating to true
		errorField.innerHTML = ''
		isAuthenticating = true
		authBtn.innerText = 'Tikrinama...'

		try {
			let data
			if (isRegistration) {
				// register an account
				const response = await fetch(apiBase + 'auth/register', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ username: emailVal, password: passVal, nickname: nicknameVal, isTeacher: isTeacherVal })
				})
				data = await response.json()
			} else {
				// login an account
				const response = await fetch(apiBase + 'auth/login', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ username: emailVal, password: passVal })
				})
				data = await response.json()
				console.log(data)
			}

			if (isRegistration && data.message == 'registration successful') {
				errorField.innerHTML = 'Paskyra sėkmingai sukurta';
				email.value = '';
    	 		password.value = '';
				nickname.value = '';
				isTeacher.checked = false;
				toggleIsRegister();
			} else if (data.token) {
				const userData = {
					token: data.token,
					userId: data.userId,
					nickname: data.nickname,
					accType: data.accType,
					teacher: data.teacher
				};

				localStorage.setItem('userData', JSON.stringify(userData));
				window.location.href = `test/LT/matematika/index.html`;
			} else {
				if (data.message == 'User not found') {
					errorField.innerHTML = 'Vartotojas nerastas';
				} else if (data.message == 'Invalid password') {
					errorField.innerHTML = 'Neteisingas slaptažodis';
				} else if (data.message = 'Username is already taken') {
					errorField.innerHTML = 'Elektroninis paštas jau užimtas';
				} else if (data.message = 'Database is not available') {
					errorField.innerHTML = 'Duomenų bazė nepasiekamia. Bandykite vėliau';	
				} else if (data.message = 'Unexpected error') {
					errorField.innerHTML = 'Kažkas nepavyko, bandykite vėliau';
				} else throw Error('Kažkas nepavyko')
			}
		} catch (err) {
			alert('Nepavyko pasiekti duomenų. Bandykite vėl vėliau.');
			console.log('Error fetching tasks:', err);
		} finally {
			isAuthenticating = false
			if (isAuthenticating) {
				authBtn.innerText = 'Prisiregistruoti'
			} else {
				authBtn.innerText = 'Prisijungti'
			}
		}
}

	</script>
</body>

</html>
