<!DOCTYPE html>
<html>

<head>
	<title>Mintinis Skai&#x10D;iavimas</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="sudEdu skirtas priešmokyklinio ugdymo, pradinių bei aukštesnių klasių mokinių aritmetinių veiksmų (sudėties, atimties, daugybos, dalybos) mintinio skaičiavimo, teksto suvokimo ir rašybos įgūdžių tobulinimui.">
	<meta name="keywords" content="mintinis skaičiavimas, mintinas skaičiavimas, skaičiavimas mintinai, matematika, pradinukai, priešmokyklinis ugdymas, priešmokyklinukai, pradinis ugdymas, atminties lavinimas, skaitinė lygybė, skaitinė lygybė su nežinomuoju, sudėtis, dėmuo, atimtis, turinys, atėminys, daugyba, dauginamasis, daugiklis, dalyba, dalinis, daliklis, daugybos lentelė, lentelinė sudėtis, lentelinė atimtis, sudėtis iki 10, sudėtis iki 20, sudėtis iki 100, sudėtis iki 1000, atimtis iki 10, atimtis iki 20, atimtis iki 100, atimtis iki 1000, vienaženkliai skaičiai, dviženkliai skaičiai, triženkliai skaičiai, keturženkliai skaičiai, peržengiant dešimtį, peržengiant šimtą, peržengiant tūkstančių vienetus, išardant dešimtį, išardant šimtą, išardant tūkstančių vienetus, pergrupuojant dešimtis, pergrupuojant šimtus, peržengiant tūkstančių vienetus, rašyba, gramatika, rašinelis, teksto suvokimas, teksto komponavimas, tekso strūktura, teksto struktūros išdestymas, atnaujinta pradinio ugdymo programa">

	  <link rel="canonical" href="https://www.sudedu.lt/LT/">
	  <link rel="alternate" href="https://www.sudedu.lt/LT/" hreflang="lt">
	  <link rel="alternate" href="https://www.sudedu.lt/EN/" hreflang="en">
	<link rel="icon" href="../images/favicon.ico" type="image/x-icon">
	<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@400;700&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Andika:wght@400;700&family=Josefin+Sans&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
	<link rel="stylesheet" type="text/css" href="/index.css">
    <link rel="stylesheet" type="text/css" href="../../user-nav-menu.css">

    <style>
        html,
        body {
            height: auto;
        }

        body {
            padding: 50px 0 ;
        }

        .row {
            width: 100%;
            min-width: 100%;
            --bs-gutter-x: 0; 
        }

        #teacher-gui {
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        #dynamic-teacher-content {
            min-height: 50vh;
        }

        .teacher-button-line {
            margin-bottom: 15px;
        }

        .teacher-button {
            min-width: 250px;
        }

        .teacher-button:disabled {
            background-color: #B6C867;
            border-color: #B6C867;
            color: black;
            filter: grayscale(25%);
        }

        #confirm-delete-task-button,
        #confirm-delete-student-button {
            min-width: 150px;
            margin-left: 15px;
        }
        
        #teacher-message-line,
        #student-message {
            text-align: center;
            margin-right: 4vw;
        }

        #task-group-sorting {
            width: 100%;
            padding: 0;
            margin-bottom: 15px;
            padding: 5px;
        }

        #outer-student-list-container {
            box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.2);
        }

        #student-list-header {
            background-color: #FAEDCD;
            border-bottom: #6c757d 1px solid;
        }

        #student-list-header-checkbox-container,
        #student-list-title-container {
            padding: 10px 0 10px 0;
            margin-left: 20px;
            font-weight: bold;
            text-transform: uppercase;
        }

        #select-all-checkbox {
            margin-right: 10px;
        }

        #student-list {
            background-color: #FAEDCD;
            height: 50vh;
            overflow: auto;
            padding-top: 5px;
        }

        .student-checkbox,
        .task-checkbox {
            margin-right: 10px;
        }

        #student-list ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .outer-student-list-entry-item {
            display: flex;
            flex-direction: column;
            align-items: start;
            justify-content: center;
        }

        .student-li-item {
            margin-left: 10px;
            display: flex;
            align-items: center;
            justify-content: start;
            font-weight: bold;
            text-transform: uppercase;
        }

        .task-li-item {
            margin-left: 30px;
            display: flex;
            align-items: center;
            justify-content: start;
        }

        .student-li-item,
        .task-container {
            width: calc(100% - 10px);
        }

        .task-li-item {
            width: calc(100% - 20px);
        }

        .student-li-item .selection-option {
            width: 80%;
            transition: box-shadow 0.3s ease; /* Smooth transition for highlighting */
        }

        .task-li-item .selection-option {
            width: calc(80% - 5px);
            transition: box-shadow 0.3s ease; /* Smooth transition for highlighting */
        }

        .selected-option {
            background-color: #fdf7e8;
            box-shadow: 0 0 0 5px #fdf7e8; /* Adds a glow effect around the selected element */
        }

        .selection-option.temp-disabled {
            pointer-events: none;
        }

        #student-list li { 
            padding: 10px 0 0 10px; 
        }

        #new-task-options-container {
            padding-left: 25px;
        }

        .group_name_div {
            width: 100%;
            margin-bottom: 15px;
        }

        #group_name {
            width: 100%;
        }

        .modeChoice4_div {
            width: 100%;
            padding: 0;
        }
        
        .empty-placeholder-between-options {
            padding: 0;
            width: 100%;
        }

        #timer-input-teacher,
        #question-number-input {
            width: 55px;
        }

        .timer-label-teacher,
        .answer-number-label-teacher {
            margin-left: 10px;
        }

        #student-task-info-container {
            width: 100%;
            padding-left: 25px;
        }

        #student-task-info-container-inner {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            width: 100%;
            height: 100%;
            background-color: #FAEDCD;
            box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.2);
            padding: 15px;
        }

        #mistakes-summary {
            margin-top: 10px;
            max-height: 200px;
            overflow-y: scroll;
        }

        table {
            width: 100%;
            height: 100%;
            border-collapse: collapse;
            border-color: rgba(255, 255, 255, 0.2);
            overflow: hidden;
            margin: 0 !important;
        }

        th,
        td {
            padding: 5px 5px 5px 10px;
            background-color: rgba(255, 255, 255, 0.2);
            font-size: 1rem;
        }

        th:first-child, th:nth-child(2) {
            text-align: center;
        }

        td:first-child, td:nth-child(2) {
            text-align: center;
        }

        tbody tr:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        tbody td:hover:before {
            content: "";
            position: absolute;
            left: 0;
            right: 0;
            top: -9999px;
            bottom: -9999px;
            background-color: rgba(255, 255, 255, 0.2);
            z-index: 2;
        }

        tbody td {
            position: relative;
        }

        .bar {
            height: 20px;
            border-radius: 5px;
        }

        .table-container {
            width: 100%;
            max-height: 50% !important;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .table-container::-webkit-scrollbar {
        display: none;
        }

        .table-container:hover {
        overflow-y: scroll;
        }

        #student-task-student-name {
            font-weight: bold;
            text-transform: uppercase;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }
        
        #student-task-group-and-status-idnicator {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        #student-task-group,
        #student-task-group-for-student {
            font-weight: bold;
            text-transform: uppercase;
            font-size: 1.25rem;
        }

        .student-list-task-indicatior {
            display: inline-block;
            margin-left: 5px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        #student-task-status-indicator,
        #student-task-status-indicator-for-student {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        #task-description-title,
        #task-description-title-for-student {
            margin-top: 15px;
        }

        #task-description-for-student {
            margin-top: 15px;
        }

        .reset-button-div {
            margin-top: 20px;
        }

        #task-description-list {
            margin-bottom: 0;
        }

        .task-description-list-item {
            text-transform: lowercase;
        }

        #change-teacher-input {
            margin-bottom: 5px;
        }

        #teacher-name {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        #change-teacher-toggle-button {
            text-decoration: underline;
            cursor: pointer;
            text-align: start;
        }

        #add-change-teacher-buttons {
            height: 38px;
            margin: 10px 0;
        }

        #student-task-for-students-title-container {
            background-color: #FAEDCD;
            padding: 10px 0 10px 15px;
            font-weight: bold;
            text-transform: uppercase;
            border-bottom: #6c757d 1px solid;
        }

        #student-tasks-list {
            background-color: #FAEDCD;
            height: 50vh;
            overflow: auto;
            padding-top: 5px;
        }

        #student-tasks-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .task-li-item-for-students {
            padding-top: 10px;
            margin-left: 15px;
        }

        #dynamic-student-content {
            padding-left: 25px;
        }

        #task-info-container-for-students {
            height: 100%;
            width: 100%;
        }

        @media (max-width: 1999px) {
            #teacher-message-line,
            #student-message {
                margin-right: 8vw;
            }
        }

        @media (max-width: 767px) {
            #student-task-info-container {
                padding-left: 0;
                margin-top: 20px;
            }
            #teacher-message-line {
                margin-right: 0;
            }
        }

    </style>
</head>

<body>
	<div class="container" id="template-container">
        <div class="col-12 d-flex justify-content-end align-items-end" id="user-login-div">
                    <a id="user-login-anchor" href="../prisijungimas.html" class="log-in">Prisijungti</a>

                    <div id="loggedin-user-menu">
        <div class="profile">
            <div class="user">
                <h3 id="loggedin-user-nickname"></h3>
                <p id="loggedin-user-id"></p>
            </div>
            <div class="img-box">
                <div class="img-box"></div>
            </div>
        </div>
        <div class="menu">
            <ul>
                <li><a href="uzduotys.html"><i class="ph-bold ph-user"></i>&nbsp;Užduotys</a></li>
                <li><a href="#" onclick="clearUserData()"><i class="ph-bold ph-envelope-simple"></i>&nbsp;Atsijungti</a></li>
            </ul>
        </div>
                    </div>
                </div>

        <div class="row d-flex align-items-center justify-content-center">
            <div id="teacher-gui" style="display: none;">

            <div class="col-12" id="button-message-section">
                <div class="row d-flex" id="button-message-subsection">
                    <div class="col-lg-6 col-md-8 col-12">

                <div class="col-12 d-flex align-items-center justify-content-start teacher-button-line">
                <button id="new-task-button" class="btn btn-primary teacher-button" onclick="toggleAddNewTask()">Nauja užduotis</button>
                </div>

                <div class="col-12 d-flex align-items-center justify-content-start teacher-button-line">
                <button id="delete-task-button" class="btn btn-primary teacher-button"" onclick="toggleDeleteTask()">Ištrinti užduotis</button>
                <button style="display: none;" id="confirm-delete-task-button" class="btn btn-primary" onclick="deleteSelectedTasks()">Trinti užduotis</button>
                </div>

                <div class="d-flex align-items-center justify-content-start teacher-button-line">
                <button id="delete-student-button" class="btn btn-primary teacher-button"" onclick="toggleDeleteStudent()">Pašalinti mokinius</button>
                <button style="display: none;" id="confirm-delete-student-button" class="btn btn-primary" onclick="deleteStudents()">Šalinti mokinius</button>
                </div>
            </div>

                <div class="col-lg-6 col-md-4 col-12 d-flex align-items-center justify-content-center teacher-button-line">
                    <div id="teacher-message-line"></div>
                </div>
            </div>
            </div>

            <div class="d-flex row" id="section-under-buttons">
            <div class="col-12 col-md-6 col-lg-5">
            <div id="student-details-for-teachers">
                <select class="btn btn-secondary dropdown-toggle dropdown dropdown-options" id="task-group-sorting">
                </select>
                <div id="outer-student-list-container">
                <div class="align-items-center justify-content-start" id="student-list-header">
                <div class="align-items-center justify-content-start" id="student-list-header-checkbox-container" style="display: none;">
                    <input type="checkbox" id="select-all-checkbox">
                    <div>pasirinkti visus</div>
                </div>
                <div class="align-items-center justify-content-start" id="student-list-title-container">
                    <div>Mokinių sąrašas:</div>
                </div>
                </div>
                <div id="student-list"></div>
            </div>
            </div>
            </div>

            <div class="col-12 col-md-6 col-lg-7" id="dynamic-teacher-content">
                <div id="new-task-options-container" style="display: none;">

                    <div class="row d-flex justify-content-center align-items-center text-center group_name_div">
                        <input type="text" id="group_name" placeholder="Užduočių grupės pavadinimas" class="form-control">
                    </div>

                    <div class="row d-flex justify-content-center align-items-center text-center mode_choice_div">
                        <select class="btn btn-secondary dropdown-toggle dropdown dropdown-options" name="mode_choice"
                            id="mode_choice">
                            <option value="sudetis">SUD&#x116;T&#x12E;</option>
                            <option value="atimtis">ATIMT&#x12E;</option>
                            <option value="sudetis ir atimtis">SUD&#x116;T&#x12E; IR ATIMT&#x12E;</option>
                            <option value="daugyba">DAUGYB&#x104;</option>
                            <option value="dalyba">DALYB&#x104;</option>
                            <option value="daugyba ir dalyba">DAUGYB&#x104; IR DALYB&#x104;</option>
                            <option value="visi">ĮVAIRIUS VEIKSMUS</option>
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-sm-12 empty-placeholder-between-options" id="empty-placeholder-top"></div>
                    </div>
                    <div class="row d-flex justify-content-center align-items-center text-center mode_choice_2_div">
                        <div class="col-12 d-flex justify-content-center align-items-center mode_choice_2_div text-center"
                            id="mode_choice_2_div">
                            <select class="btn btn-secondary dropdown-toggle dropdown dropdown-options" name="mode_choice_2"
                                id="mode_choice_2">
                                <option value="viena10">VIENAŽENKLIŲ SKAIČIŲ IKI 10</option>
                                <option value="viena">VIENAŽENKLIŲ SKAIČIŲ IKI 20 (LENTELINĖ SUDĖTIS)</option>
                                <option value="dvivien20">DVIŽENKLIO IR VIENAŽENKLIO SKAIČIŲ IKI 20</option>
                                <option value="dvivien">DVIŽENKLIO IR VIENAŽENKLIO SKAIČIŲ IKI 100</option>
                                <option value="dvi">DVIŽENKLIŲ SKAIČIŲ IKI 100</option>
                                <option value="tukst">SKAIČIŲ IKI 1 000</option>
                                <option value="dtukst">SKAIČIŲ IKI 10 000</option>
                                <option value="mil">SKAIČIŲ IKI 1 000 000</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12 empty-placeholder-between-options" id="placeholder-bottom"></div>
                    </div>
                    <div class="row">
                        <div class="col-12 d-flex justify-content-center align-items-center number_choice_div text-center">
                            <label class="number-choice-label-nuo" for="selected_number" id="number_label"
                                style="display: none;">NUO</label>
                            <select class="btn btn-secondary dropdown-toggle dropdown text-center" name="selected_number"
                                id="selected_number" style="display: none;">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                            </select>
                            <label class="number-choice-label-iki" for="selected_number_2" id="number_label_2"
                                style="display: none;">IKI</label>
                            <select class="btn btn-secondary dropdown-toggle dropdown text-center" name="selected_number_2"
                                id="selected_number_2" style="display: none;">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-12 empty-placeholder-after-number-options" id="empty-placeholder-after-numbers" style="display: none;"></div>
                    <div class="row d-flex justify-content-center align-items-center text-center remainder-div">
                    <label id="remainder-option" style="display: none;">
                        <input id="remainder-input" type="checkbox" name="myCheckbox"> DALYBA SU LIEKANA
                    </label>
                    </div>
                    
                    <div class="row d-flex justify-content-center align-items-center text-center mode_choice_3_div">
                        <div
                            class="col-12 d-flex justify-content-center align-items-center number_choice_div text-center mode_choice_3_div"
                            id="mode_choice_3_div">
                            <select class="btn btn-secondary dropdown-toggle dropdown text-center" name="mode_choice_3"
                                id="mode_choice_3">
                                <option value="neper">NEPERŽENGIANT DEŠIMTIES</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-12 empty-placeholder-between-options placeholder-before-skaitinis" id="empty-placeholder-before-mode-choice-div-5"></div>
                    <div class="row d-flex justify-content-center align-items-center text-center mode_choice_div">
                        <select class="btn btn-secondary dropdown-toggle dropdown dropdown-options" name="mode_choice_5"
                            id="mode_choice_5">
                            <option value="skaitiniai">SKAITINĖ LYGYBĖ</option>
                            <option value="nezinomieji">SKAITINĖ LYGYBĖ SU NEŽINOMUOJU</option>
                        </select>
                    </div>
                    <div class="col-sm-12 empty-placeholder-between-options" id="empty-placeholder-top"></div>
                    <div class="row d-flex justify-content-center align-items-center text-center mode_choice_div">
                        <select class="btn btn-secondary dropdown-toggle dropdown dropdown-options" name="mode_choice_6"
                            id="mode_choice_6" style="display: none;">
                            <option value="turinys">NEŽINOMAS DĖMUO</option>
                        </select>
                    </div>
                    <div class="row d-flex justify-content-center align-items-center text-center mode_choice_div">
                        <select class="btn btn-secondary dropdown-toggle dropdown dropdown-options" name="mode_choice_7"
                            id="mode_choice_7" style="display: block;">
                            <option value="eilute">EILUTE</option>
                            <option value="stulpeliu">STULPELIU / KAMPU</option>
                        </select>
                    </div>
                    <div class="col-sm-12 empty-placeholder-between-options" id="empty-placeholder-top"></div>
                    <div class="row d-flex justify-content-center align-items-center text-center modeChoice4_div">
                        <select class="btn btn-secondary dropdown-toggle dropdown dropdown-options" name="modeChoice4"
                            id="mode_choice_4" style="display: block;">
                            <option value="timer">NUSTATYTI LAIKO TRUKMĘ</option>
                            <option value="questionNumber">NUSTATYTI KLAUSIMŲ KIEKĮ</option>
                        </select>
                    </div>

                    <div class="col-sm-12 empty-placeholder-between-options" id="empty-placeholder-top"></div>
                    <div class="row d-flex justify-content-center align-items-center" >
                        <div class="timer-input-div row justify-content-center align-items-center" id="timer-input-div">
                        <div class="col-6 d-flex justify-content-end">
                                    <input type="number" id="timer-input-teacher" min="1" max="60" step="1" value="5">
                    </div>
                    <div class="col-6 d-flex d-flex justify-content-start">
                      <h3 class="timer-label-teacher">minutes</h3>
                    </div>
                  </div>
                  <div class="question-number-input-div row justify-content-center align-items-center" id="question-number-input-div" style="display: none;">
                  <div class="col-6 d-flex justify-content-end">
                                    <input type="number" id="question-number-input" min="1" max="200" step="1" value="20">
                                    </div>
                      <div class="col-6 d-flex d-flex justify-content-start">
                        <h3 class="answer-number-label-teacher">veiksmų</h3>
                      </div>
                      </div>
                            </div>


                        <div class="col-sm-12 empty-placeholder-before-submit"></div>

                        <div class="d-flex align-items-center justify-content-center">
                        <div class="col-12 d-flex justify-content-center align-items-center submit-button">
                            <button onclick="setTask()" class="btn btn-primary" id="submit-new-taks-button">Užduoti</button>
                        </div>
                    </div>


                </div>

                <div id="student-task-info-container">
                <div id="student-task-info-container-inner">
                    <div>
                    <div class="col-12 d-flex align-items-center justify-content-start" id="student-task-student-name"></div>
                    <div id="student-task-group-and-status-idnicator">
                        <div id="student-task-group"></div>
                        <div id="student-task-status-indicator"></div>
                    </div>
                    <div class="col-12" id="student-score-asnwer-number"></div>
                    <div class="col-12" id="student-score-mistake-number"></div>

                    <div id="mistakes-table-title"></div>
                    <div id="mistakes-summary">
                            <div class="col-12 table-container">
                                <div id="summary-table"></div>
                            </div>
                    </div>
                    <div id="task-description-outer-container">
                        <div id="task-description-title" style="display: none;">Užduoties aprašymas:</div>
                        <div id="task-description"></div>
                    </div>
                </div>
                </div>
                </div>
            </div>
            </div>
        </div>

            <div id="student-gui" class="row" style="display: none;">
                <div class="row">
                    <div class="col-md-6 col-12">
                        <div id="teacher-name"></div>

                        <input id="add-teacher-input" type="text" placeholder="mokytojo ID" style="display: none;">
                        <input id="change-teacher-input" type="text" placeholder="mokytojo ID" style="display: none;">
                        <a onclick="changeTeacherToggle()" id="change-teacher-toggle-button">Keisti mokytoją</a>
                        <div id="add-change-teacher-buttons">
                        <button id="add-teacher" class="btn btn-primary" onclick="addTeacher()" style="display: none;">Pridėti mokytoją</button>
                        <button id="change-teacher" class="btn btn-primary" onclick="changeTeacher()" style="display: none;">Keisti mokytoją</button>
                    </div>
                    </div>
                    <div class="col-md-6 col-12 d-flex justify-content-center align-items-center">
                        <div id="student-message"></div>
                    </div>
                </div>
                <div class="row">
                <div class="col-12 col-md-6 col-lg-5" id="student-tasks-list-outer-container">
                <div class="align-items-center justify-content-start" id="student-task-for-students-title-container">
                    <div id="task-list-title-for-students"></div>
                </div>
                <div id="student-tasks-list">

                </div>
                </div>
    
                <div class="col-12 col-md-6 col-lg-7" id="dynamic-student-content">
                    <div id="task-info-container-for-students">
                            <div id="student-task-info-container-inner">
                                <div>
                                <div id="student-task-group-and-status-idnicator">
                                    <div id="student-task-group-for-student"></div>
                                    <div id="student-task-status-indicator-for-student"></div>
                                </div>
                                <div class="col-12" id="student-score-asnwer-number-for-student"></div>
                                <div class="col-12" id="student-score-mistake-number-for-student"></div>
            
                                <div id="mistakes-table-title-for-student"></div>
                                <div id="mistakes-summary">
                                        <div class="col-12 table-container">
                                            <div id="summary-table-for-student"></div>
                                        </div>
                                </div>
                                <div id="task-description-outer-container-for-student">
                                    <div id="task-description-for-student"></div>
                                </div>
                            </div>
                                <div class="col-12 d-flex align-items-center justify-content-end">
                                <button id="complete-task-button" class="btn btn-primary" onclick="completeTask()" style="display: none;">Atlikti užduotį</button>
                                </div>
                            </div>
                    </div>
                </div>
                </div>
            </div>

            <div id="admin-gui" class="flex-column justify-content-center align-items-center" style="display: none;">
                <div class="row d-flex flex-column justify-content-center align-items-center" style="width: 50%; min-width: 50%;">
                <h2>REMOVE USER</h2>
                <input id="admin-remove-user-input" placeholder="user email">
                <button id="admin-remove-user-button" onclick="deleteUser()" class="btn btn-primary" style="margin-top: 15px;">Remove user</button>
                </div>
            </div>

            <div class="col-12 d-flex justify-content-end align-items-center">
			<div class="reset-button-div">
					<button class="btn btn-primary reset-button"><span class="material-symbols-rounded">roofing</span></button>
			</div>
		</div>

        </div>

    </div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
		crossorigin="anonymous"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="../../mental-arithmetic.js"></script>
	<script src="../../mental-arithmetic-combinations.js"></script>
    <script src="matematika_options.js"></script>
    <script src="pasirinkimai.js"></script>
    <script src="../../user-nav-menu.js"></script>

	<script>
        const redCircleColorCode = '#D57E7E';
        const greenCircleColorCode = '#B6C867';
        let userData;

        if (userDataString) {
            userData = JSON.parse(userDataString);
        } else {
            window.location.href = '/LT/matematika/index.html';
        }

        let studentList;
        let tasksList;
        let currentTaskId;
        let currentTaskInstructions;
        let studentListDiv = document.getElementById('student-list')
        let addingNewTask = false;
        let deletingTask = false;
        let deletingStudent = false;
        let showingSelectAllCheckbox = false;
        let taskContainerVisible = true;
        let changingTeacher = false;
        const teacherGUI = document.getElementById('teacher-gui');
        const studentGUI = document.getElementById('student-gui');
        const adminGUI = document.getElementById('admin-gui');
        let studentTasksList = document.getElementById('student-tasks-list')
        let taskInfoContainerForStudents = document.getElementById('task-info-container-for-students')
        const newTaskButton = document.getElementById('new-task-button');
        const submitNewTaskButton = document.getElementById('submit-new-taks-button');
        const deleteTaskButton = document.getElementById('delete-task-button');
        const confirmDeleteTaskButton = document.getElementById('confirm-delete-task-button');
        const teacherMessageLine = document.getElementById('teacher-message-line');
        const newTaskOptions = document.getElementById('new-task-options-container');
        const studentTaskInfoContainer = document.getElementById('student-task-info-container');
        const studentTaskStudentName = document.getElementById('student-task-student-name');
        const studentTaskGroup = document.getElementById('student-task-group');

        const studentTaskStatus = document.getElementById('student-task-status');
        const studentScoreAnswerNumber = document.getElementById('student-score-asnwer-number');
        const studentScoreMistakeNumber = document.getElementById('student-score-mistake-number');
        const studentMistakesTableTitle = document.getElementById('mistakes-table-title');

        let dynamicStudentContent = document.getElementById('dynamic-student-content');

        let taskGroupForStudents = document.getElementById('task-group-for-students');
        let taskStatusForStudents = document.getElementById('task-status-for-students');

        let teacherName = document.getElementById('teacher-name');
        const addTeacherInput = document.getElementById('add-teacher-input');
        const addTeacherButton = document.getElementById('add-teacher');

        const changeTeacherToggleButton = document.getElementById('change-teacher-toggle-button');
        const changeTeacherInput = document.getElementById('change-teacher-input');
        const changeTeacherButton = document.getElementById('change-teacher');

        const deleteStudentButton = document.getElementById('delete-student-button');
        const confirmDeleteStudentButton = document.getElementById('confirm-delete-student-button');

        const studentListTitle = document.getElementById('student-list-title-container');
        const studentListSelectAllCheckbox = document.getElementById('student-list-header-checkbox-container');
        const selectAllCheckbox = document.getElementById('select-all-checkbox');

        const studentMessage = document.getElementById('student-message');

        const teacherDispalyStudentTaskIndicator = document.getElementById('student-task-status-indicator');
        const mistakesSummaryTable = document.querySelector('#summary-table');

        const taskDescriptionTitle = document.querySelector('#task-description-title');
        const taskDescription = document.querySelector('#task-description');

        const timerInputElementTeacher = document.querySelector('#timer-input-teacher');
        let timerLabelElementTeacher = document.querySelector('.timer-label-teacher');

        const studentTaskGroupForStudent = document.getElementById('student-task-group-for-student');
        const studentScoreAnswerNumberForStudent = document.getElementById('student-score-asnwer-number-for-student');
        const studentScoreMistakeNumberForStudent = document.getElementById('student-score-mistake-number-for-student');
        const studentMistakesTableTitleForStudent = document.getElementById('mistakes-table-title-for-student');
        const taskDescriptionForStudent = document.querySelector('#task-description-for-student');
        const teacherDispalyStudentTaskIndicatorForStudent = document.getElementById('student-task-status-indicator-for-student');
        const taskListTitleForStudents = document.getElementById('task-list-title-for-students');

        const completeTaskButton = document.getElementById('complete-task-button');

    timerInputElementTeacher.addEventListener("input", function(event) {
      if (parseInt(timerInputElementTeacher.value) === 1 || parseInt(timerInputElementTeacher.value.slice(-1)[0]) === 1 && parseInt(timerInputElementTeacher.value) !== 11) {
        timerLabelElementTeacher.innerHTML = 'minutę';
      } else if ((parseInt(timerInputElementTeacher.value) > 1 && parseInt(timerInputElementTeacher.value) < 10) || (parseInt(timerInputElementTeacher.value) > 20 && parseInt(timerInputElementTeacher.value.slice(-1)[0]) !== 0)) {
        timerLabelElementTeacher.innerHTML = 'minutes';
      } else if (parseInt(timerInputElementTeacher.value) >= 10 ) {
        timerLabelElementTeacher.innerHTML = 'minučių';
      }
    })

    const questionNumberInputElementTeacher = document.querySelector('#question-number-input');
    let answerNumberLabelTeacher = document.querySelector('.answer-number-label-teacher');

    questionNumberInputElementTeacher.addEventListener("input", function(event) {
      if (parseInt(questionNumberInputElementTeacher.value) === 1 || parseInt(questionNumberInputElementTeacher.value.slice(-1)[0]) === 1 && parseInt(questionNumberInputElementTeacher.value) !== 11) {
        answerNumberLabelTeacher.innerHTML = 'veiksmą';
      } else if ((parseInt(questionNumberInputElementTeacher.value) > 1 && parseInt(questionNumberInputElementTeacher.value) < 10) || (parseInt(questionNumberInputElementTeacher.value) > 20 && parseInt(questionNumberInputElementTeacher.value.slice(-1)[0]) !== 0))  {
        answerNumberLabelTeacher.innerHTML = 'veiksmus';
      } else if (parseInt(questionNumberInputElementTeacher.value) >= 10) {
        answerNumberLabelTeacher.innerHTML = 'veiksmų';
      }
    })


        function getOptionTextFromValues(values) {
            const optionsLibrary = {
                // mode_choice options
                "sudetis": "SUDĖTIS",
                "atimtis": "ATIMTIS",
                "sudetis ir atimtis": "SUDĖTIS IR ATIMTIS",
                "daugyba": "DAUGYBA",
                "dalyba": "DALYBA",
                "daugyba ir dalyba": "DAUGYBA IR DALYBA",
                "visi": "ĮVAIRŪS VEIKSMAI",
                
                // mode_choice_2 options
                "viena10": "VIENAŽENKLIŲ SKAIČIŲ IKI 10",
                "viena": "VIENAŽENKLIŲ SKAIČIŲ IKI 20 (LENTELINĖ SUDĖTIS)",
                "dvivien20": "DVIŽENKLIO IR VIENAŽENKLIO SKAIČIŲ IKI 20",
                "dvivien": "DVIŽENKLIO IR VIENAŽENKLIO SKAIČIŲ IKI 100",
                "dvi": "DVIŽENKLIŲ SKAIČIŲ IKI 100",
                "tukst": "SKAIČIŲ IKI 1 000",
                "dtukst": "SKAIČIŲ IKI 10 000",
                "mil": "SKAIČIŲ IKI 1 000 000",
                "gretnul": "KAI TURINYJE GRETIMI NULIAI",
                "lent": "LENTELINĖ SUDĖTIS IR ATIMTIS IKI 20",
                "dauglent": "DAUGYBOS LENTELĖ",
                "daugdvivien": "DVIŽENKLIO IŠ VIENAŽENKLIO",
                "daugtrivien": "TRIŽENKLIO IŠ VIENAŽENKLIO",
                "daugketvien": "KETURŽENKLIO IŠ VIENAŽENKLIO",
                "daugdaugvien": "DAUGIAŽENKLIO IŠ VIENAŽENKLIO",
                "daugdvidvi": "DVIŽENKLIO IŠ DVIŽENKLIO",
                "daugtridvi": "TRIŽENKLIO IŠ DVIŽENKLIO",
                "daugketdvi": "KETURŽENKLIO IŠ DVIŽENKLIO",
                "daugdaugdvi": "DAUGIAŽENKLIO IŠ DVIŽENKLIO",
                "daugdaug": "*DAUGIAŽENKLIŲ SKAIČIŲ",
                "pil10": "IŠ PILNŲ DEŠIMČIŲ/ŠIMTŲ (LENGVESNI)",
                "pil": "IŠ PILNŲ DEŠIMČIŲ/ŠIMTŲ/TŪKSTANČIŲ",
                "daugdaugviendalmnul": "DAUGIAŽENKLIO IŠ VIENAŽENKLIO (DALMENYJE 0)",
                "iki10": "IKI 10",
                "iki20": "IKI 20",
                "iki100": "IKI 100",
                "iki1000": "IKI 1,000",
                "iki10000": "IKI 10,000",
                "iki1000000": "IKI 1,000,000",
                
                // mode_choice_3 options
                "neper": "NEPERŽENGIANT DEŠIMTIES",
                "per10": "PERŽENGIANT DEŠIMTĮ",
                "neper": "NEIŠARDANT DEŠIMTIES",
                "neper": "NEPERŽENGIANT/NEIŠARDANT DEŠIMTIES",
                "per10": "PERŽENGIANT/IŠARDANT DEŠIMTĮ",
                "neper": "NEIŠARDANT SKAIČIŲ SKYRIŲ",
                "per10": "IŠARDANT SKAIČIŲ SKYRIUS",
                "neper": "NEPERŽENGIANT/NEIŠARDANT SKAIČIŲ SKYRIŲ",
                "per10": "PERŽENGIANT/IŠARDANT SKAIČIŲ SKYRIUS",
                "neper": "NEPERŽENGIANT SKAIČIŲ SKYRIŲ",
                
                // mode_choice_5 options
                "skaitiniai": "SKAITINĖ LYGYBĖ",
                "nezinomieji": "SKAITINĖ LYGYBĖ SU NEŽINOMUOJU",
                
                // mode_choice_6 options
                "turinys": "NEŽINOMAS DĖMUO",
                "ateminys": "NEŽINOMAS ATĖMINYS",
                "turinys": "NEŽINOMAS TURINYS",
                "dalinys": "NEŽINOMAS DAUGINAMASIS",
                "daliklis": "NEŽINOMAS DALIKLIS",
                "turinys": "NEŽINOMAS DĖMUO/TURINYS/ATĖMINYS",
                "dalinys": "NEŽINOMAS DAUGINAMASIS/DALINYS/DALIKLIS",
                "dalinys": "NEŽINOMAS DĖMUO/TURINYS/ATĖMINYS/DAUGINAMASIS/DALINYS/DALIKLIS",
                
                // mode_choice_7 options
                "eilute": "EILUTE",
                "stulpeliu": "STULPELIU / KAMPU",
                
                // mode_choice_4 options
                "timer": "NUSTATYTI LAIKO TRUKMĘ",
                "questionNumber": "NUSTATYTI KLAUSIMŲ KIEKĮ"
            };

            result = []

            function determineQuestionNumberTimeLabelEnding() {
                if (result[3] === "NUSTATYTI KLAUSIMŲ KIEKĮ") {
                    numberLabel = ''
                    if (parseInt(result[9]) === 1 || parseInt(result[9].slice(-1)[0]) === 1 && parseInt(result[9]) !== 11) {
                        numberLabel = 'KLAUSIMĄ';
                    } else if ((parseInt(result[9]) > 1 && parseInt(result[9]) < 10) || (parseInt(result[9]) > 20 && parseInt(result[9].slice(-1)[0]) !== 0)) {
                        numberLabel = 'KLAUSIMUS';
                    } else if (parseInt(result[9]) >= 10 ) {
                        numberLabel = 'KLAUSIMŲ';
                    }
                    return ("ATSAKYTI " + result[9] + " " + numberLabel)  
                } else {
                    numberLabel = ''
                    if (parseInt(result[9]) === 1 || parseInt(result[9].slice(-1)[0]) === 1 && parseInt(result[9]) !== 11) {
                        numberLabel = 'MINUTĘ';
                    } else if ((parseInt(result[9]) > 1 && parseInt(result[9]) < 10) || (parseInt(result[9]) > 20 && parseInt(result[9].slice(-1)[0]) !== 0)) {
                        numberLabel = 'MINUTES';
                    } else if (parseInt(result[9]) >= 10 ) {
                        numberLabel = 'MINUČIŲ';
                    }
                    return ("PRAKTIKUOTIS " + result[9] + " " + numberLabel)  
                }
            }
            
            result.push(optionsLibrary[values[0]])
            result.push(optionsLibrary[values[1]])
            result.push(values[2] ? "PERŽENGIANT DEŠIMTĮ" : "NEPERŽENGIANT DEŠIMTIES")
            result.push(optionsLibrary[values[3]])
            result.push(optionsLibrary[values[4]])
            result.push(optionsLibrary[values[5]])
            result.push(optionsLibrary[values[6]])
            result.push(values[7])
            result.push(values[8] ? "Dalyba su liekana" : "Dalyba be liekanos")
            result.push(values[9])

            final_results = []
            final_results.push(result[0])

            if (result[0] === "SUDĖTIS" || result[0] === "ATIMTIS" || result[0] === "SUDĖTIS IR ATIMTIS") {
                final_results.push(result[1])
                final_results.push(result[2])
                final_results.push(result[4])
                if (result[4] === "SKAITINĖ LYGYBĖ") {
                    final_results.push(result[6])  
                } else if (result[4] === "SKAITINĖ LYGYBĖ SU NEŽINOMUOJU") {
                    final_results.push(result[5])  
                }
                final_results.push(determineQuestionNumberTimeLabelEnding())
            } else if (result[0] === "DAUGYBA") {
                final_results.push(result[1])
                final_results.push(`NUO ${result[7][0]} IKI ${result[7][1]}`)
                final_results.push(result[4])
                if (result[4] === "SKAITINĖ LYGYBĖ SU NEŽINOMUOJU") {
                    final_results.push(result[5])    
                }
                final_results.push(result[6])    
                final_results.push(determineQuestionNumberTimeLabelEnding())    
            } else if (result[0] === "DALYBA" || result[0] === "DALYBA IR DALYBA") {
                final_results.push(result[1])
                final_results.push(`NUO ${result[7][0]} IKI ${result[7][1]}`)
                final_results.push(result[8])
                final_results.push(result[4])
                if (result[4] === "SKAITINĖ LYGYBĖ SU NEŽINOMUOJU") {
                    final_results.push(result[5])    
                }
                final_results.push(result[6])    
                final_results.push(determineQuestionNumberTimeLabelEnding())    
            } else if (result[0] === "ĮVAIRŪS VEIKSMAI") {
                final_results.push(result[1])
                final_results.push(result[4])
                if (result[4] === "SKAITINĖ LYGYBĖ SU NEŽINOMUOJU") {
                    final_results.push(result[5])    
                }
                final_results.push(result[6]) 
                final_results.push(determineQuestionNumberTimeLabelEnding())       
            }

            return final_results;
        }



        function toggleStudentListLabel() {
            showingSelectAllCheckbox = !showingSelectAllCheckbox
            const dropdown = document.getElementById("task-group-sorting");
            if (showingSelectAllCheckbox) {
                studentListTitle.style.display = "none"
                studentListSelectAllCheckbox.style.display = "flex"
                selectAllCheckbox.checked = false
            } else {
                studentListTitle.style.display = "flex"
                studentListSelectAllCheckbox.style.display = "none"
                selectAllCheckbox.checked = false
            }
        }

        document.getElementById('select-all-checkbox').addEventListener('change', function () {
            const checkboxes = document.querySelectorAll('#student-list input[type="checkbox"]');

            checkboxes.forEach(checkbox => {
                if (getComputedStyle(checkbox).visibility !== 'hidden') {
                    checkbox.checked = this.checked;
                }
            });
        });

        function toggleDeleteStudent() {
            deletingStudent = !deletingStudent
            const dropdown = document.getElementById("task-group-sorting");
            toggleStudentListLabel();
            clearTaskInfoContainer();
            if (deletingStudent) {
                clearTeacherMessage();
                // Set the selected option to "Visos užduočių grupės"
                dropdown.value = "Visos užduočių grupės";
                // Manually trigger the change event
                dropdown.dispatchEvent(new Event("change"));
                dropdown.disabled = true;
                toggleTaskVisibility()

                confirmDeleteStudentButton.style.display = "block";       
                document.querySelectorAll('.student-checkbox').forEach(checkbox => {
                checkbox.style.visibility = "visible";
                checkbox.disabled = false;
            });
                deleteStudentButton.innerText = 'Atšaukti mokinių šalinimą';
                newTaskButton.disabled = true;
                deleteTaskButton.disabled = true;

            } else {
                toggleTaskVisibility()
                confirmDeleteStudentButton.style.display = "none";   
                document.querySelectorAll('.student-checkbox').forEach(checkbox => {
                checkbox.style.visibility = "hidden";
                checkbox.checked = false;
            });
                deleteStudentButton.innerText = 'Pašalinti mokinius';
                newTaskButton.disabled = false;
                deleteTaskButton.disabled = false;
                dropdown.disabled = false;
            }
        }

        async function deleteStudents() {
            let studentsToRemove = [];
            document.querySelectorAll('.student-checkbox').forEach(checkbox => {
                if (checkbox.checked) {
                    studentsToRemove.push(parseInt(checkbox.value));
                }
            });
            
            if (studentsToRemove.length === 0) {
                teacherMessageLine.innerHTML = "Pasirinkite bent vieną mokinį pašalinimui!"
                return
            }

            const studentIdsBeingRemoved = studentsToRemove.map(id => parseInt(id));
    
            // Find matching students and collect assignmentIds
            const assignmentIds = [];
            
            studentList.forEach(student => {
                if (studentIdsBeingRemoved.includes(student.id)) {
                    student.tasks.forEach(task => {
                        assignmentIds.push(task.assignmentId);
                    });
                }
            });

            deleteStudentButton.disabled = true
            confirmDeleteStudentButton.innerHTML = "Trinama..."
            
            deletingTask = true
            await deleteTasks(assignmentIds)

            try {
                // Prepare the list of tasks to delete (assuming tasksToTemove is already populated)
                const studentsToDelete = studentsToRemove;  // Ensure this array holds task IDs to be deleted

                const response = await fetch(apiBase + 'students', {
                    method: 'DELETE',  // Change to DELETE method
                    headers: {
                        'Authorization': userData.token,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ studentIds: studentsToDelete })  // Send the list as JSON in the body
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                // Optionally, handle the response if needed (e.g., confirm deletion or update the UI)
                const result = await response.json();
                if (result.message === "Student removal successful.") {
                    fetchDataForTeachers()
                    teacherMessageLine.innerHTML = "Mokinių šalinimas sėkmingas.";
                } 

            } catch (error) {
                console.log('Error deleting tasks:', error);
                teacherMessageLine.innerHTML = 'Nepavyko pašalinti mokinių. Bandykite vėl vėliau.';

            } finally {
                deleteStudentButton.disabled = false
                confirmDeleteStudentButton.innerHTML = "Šalinti mokinius"
                showingSelectAllCheckbox = true;
                toggleDeleteStudent() 
                clearTaskInfoContainer();
            }
        }




        async function addTeacher() {
            const teacherId = addTeacherInput.value;
            if (!teacherId) return;

            try {
                const response = await fetch(apiBase + 'students', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': userData.token
                    },
                    body: JSON.stringify({ teacherId })
                });

                // Safely parse response (fallback if JSON fails)
                const responseData = await response.json().catch(() => ({}));

                if (!response.ok) {
                    if (responseData.error === 'Invalid teacher ID') {
                        alert("Neteisingas mokytojo ID numeris.");
                    } else if (responseData.error === 'Relationship already exists') {
                        alert("Šis mokytojas jau yra jūsų sąraše.");
                    } else if (responseData.error === 'Student already has a teacher. Use PUT to update instead.') {
                        alert("Jau turi pridėtą mokytoją.");
                    } else {
                        throw new Error(`Server error: ${response.status}`);
                    }
                    return;
                }

                userData.teacher = responseData.teacherInfo
                localStorage.setItem('userData', JSON.stringify(userData))

                if (userData.teacher === '') {
                    addTeacherInput.style.display = "block";
                    addTeacherButton.style.display = "block";
                    changeTeacherToggleButton.style.display = "none"
                } else {
                    teacherName.innerHTML = `Mok. ${userData.teacher}`
                    addTeacherInput.style.display = "none";
                    addTeacherButton.style.display = "none";
                    changeTeacherToggleButton.style.display = "block"
                }

                studentMessage.innerHTML = "Mokytojas pridėtas sėkmingai."
            } catch (error) {
                console.log('Full error:', error);
                studentMessage.innerHTML = "Įvyko klaida. Bandykite vėl vėliau."
            }
        }

        async function changeTeacher() {
            const teacherId = changeTeacherInput.value;
            if (!teacherId) return;

            try {
                const response = await fetch(apiBase + 'students', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': userData.token
                    },
                    body: JSON.stringify({ teacherId })
                });

                // Safely parse response (fallback if JSON fails)
                const responseData = await response.json().catch(() => ({}));

                if (!response.ok) {
                    if (response.status === 400 && responseData.error === 'Invalid teacher ID') {
                        studentMessage.innerHTML = "Neteisingas mokytojo ID numeris."
                    } else if (response.status === 404 && responseData.error === 'No existing teacher relationship found') {
                        studentMessage.innerHTML = "Nerastas esamas mokytojo ryšys. Pirmiausia pridėkite mokytoją."
                    } else if (response.status === 400 && responseData.error === 'Student already has this teacher') {
                        studentMessage.innerHTML = "Šis mokytojas jua pridėtas."
                    } else if (response.status === 400 && responseData.error === 'No existing teacher relationship found. Use POST to create one.') {
                        studentMessage.innerHTML = "Neturi pridėto mokytojo."
                    } else {
                        throw new Error(`Server error: ${response.status}`);
                    }
                    return;
                }
                
                userData.teacher = responseData.teacherInfo
                localStorage.setItem('userData', JSON.stringify(userData))

                if (userData.teacher === '') {
                    addTeacherInput.style.display = "block";
                    addTeacherButton.style.display = "block";
                    changeTeacherToggleButton.style.display = "none"
                } else {
                    teacherName.innerHTML = `Mok. ${userData.teacher}`
                    teacherName.style.display = "block"
                    addTeacherInput.style.display = "none";
                    addTeacherButton.style.display = "none";
                    changeTeacherInput.style.display = "none";
                    changeTeacherButton.style.display = "none";
                    changeTeacherToggleButton.style.display = "block"
                    changeTeacherToggle();
                }

                deleteAllTasks();
                studentMessage.innerHTML = "Mokytojas sėkmingai pakeistas."

            } catch (error) {
                console.log('Full error:', error);
                studentMessage.innerHTML = "Įvyko klaida keičiant mokytoją. Bandykite vėl vėliau."
            }
        }

        function clearTaskInfoContainer() {
            studentTaskStudentName.innerHTML = '';
            studentTaskGroup.innerHTML = '';
            studentScoreAnswerNumber.innerHTML = '';
            studentScoreMistakeNumber.innerHTML = '';
            mistakesSummaryTable.innerHTML = '';
            taskDescription.innerHTML = '';
            studentMistakesTableTitle.innerHTML = '';
            taskDescriptionTitle.style.display = "none"
            teacherDispalyStudentTaskIndicator.style.display = "none"
        }

        function clearTaskInfoContainerForStudents() {
            studentTaskGroupForStudent.innerHTML = '';
            studentScoreAnswerNumberForStudent.innerHTML = '';
            studentScoreMistakeNumberForStudent.innerHTML = '';
            studentMistakesTableTitleForStudent.innerHTML = '';
            document.querySelector("#summary-table-for-student").innerHTML = '';
            taskDescriptionForStudent.innerHTML = '';
            teacherDispalyStudentTaskIndicatorForStudent.style.display = "none"
        }

        function clearTeacherMessage() {
            teacherMessageLine.innerHTML = '';
        }

        function clearStudentMessage() {
            studentMessage.innerHTML = '';
        }

        function displayStudentStatistics(student, studentTasks) {
            function combineStudentTaskResults(studentTasks) {
        let combinedResult = {
            result: [[0, 0], []], // Initialize with sums and an empty array for the combined lists
            totalTasks: 0,
            completedTasks: 0
        };

        if (studentTasks && studentTasks.length > 0) { // Ensure there are tasks to process
            studentTasks.forEach(task => {
                // Increment total task count
                combinedResult.totalTasks += 1;

                // If the task status is true, increment the completedTasks count
                if (task.status === true) {
                    combinedResult.completedTasks += 1;
                }

                // Safely parse result if it exists
                let result = [];
                try {
                    result = JSON.parse(task.result);
                } catch (e) {
                    console.error("Error parsing result for task", task);
                    return; // Skip this task if it can't be parsed
                }

                if (Array.isArray(result) && result.length > 0) {
                    // Add the result[0][0] numbers together, checking for valid data
                    if (Array.isArray(result[0]) && result[0].length >= 2) {
                        combinedResult.result[0][0] += result[0][0] || 0; // Default to 0 if the value is undefined or not valid
                        combinedResult.result[0][1] += result[0][1] || 0; // Same for result[0][1]
                    }

                    // Combine the result[1] lists together, ensuring it's an array
                    if (Array.isArray(result[1])) {
                        combinedResult.result[1] = combinedResult.result[1].concat(result[1]);
                    }
                }
            });
        }

        // Return the updated combined data with task counts
        return combinedResult;
    }
        clearTaskInfoContainer();
        clearTeacherMessage();
        studentTaskInfoContainer.style.display = 'block';
        studentTaskStudentName.innerHTML = `${student[1]} (ID: ${student[0]})`;

        combinedStudentData = combineStudentTaskResults(studentTasks)

        studentScoreAnswerNumber.innerHTML = `Baigtos užduotys: ${combinedStudentData.completedTasks}/${combinedStudentData.totalTasks}`
        mistakeFrequency = Math.round(combinedStudentData.result[0][1]/combinedStudentData.result[0][0]*100)

        if (!isNaN(mistakeFrequency)) {
            studentScoreMistakeNumber.innerHTML = `Klaidų dažnis: ${mistakeFrequency}%`;
        }
        if (combinedStudentData.result[1].length > 0) {
            studentMistakesTableTitle.innerHTML = "Dažniausios klaidos:"
            generateSummaryTable("custom", combinedStudentData.result[1]) 
        }
    }
                

        function displayTaskInfo(student, task) {
            clearTaskInfoContainer();
            clearTeacherMessage();

            studentTaskInfoContainer.style.display = 'block';
            taskDescriptionTitle.style.display = "block"
            teacherDispalyStudentTaskIndicator.style.display = "block"

            studentTaskStudentName.innerHTML = `${student[1]} (ID: ${student[0]})`;
            studentTaskGroup.innerHTML = `Užduotis: ${task.group}`;
            teacherDispalyStudentTaskIndicator.style.backgroundColor = task.status ? greenCircleColorCode : redCircleColorCode;
            if (task.result !== '') {
                score = JSON.parse(task.result)[0]
                studentScoreAnswerNumber.innerHTML = `Atsakyti klausimai: ${score[0]}`;
                studentScoreMistakeNumber.innerHTML = `Padarytos klaidos: ${score[1]}`;
                let mistakesList = [];
                mistakesList = JSON.parse(task.result)[1]
                if (mistakesList.length > 0) {
                    studentMistakesTableTitle.innerHTML = "Dažniausios klaidos:"
                    generateSummaryTable("custom", mistakesList) 
                }
            }

            const formattedTaskDescription = getOptionTextFromValues(JSON.parse(task.taskDescription))
            taskDescriptionList = document.createElement('ul');
            taskDescriptionList.classList.add("task-description-list")
            formattedTaskDescription.forEach(item => {
                if (item) {  // Ensure empty values are not added
                    let listItem = document.createElement('li');
                    listItem.textContent = item;
                    listItem.classList.add("task-description-list-item")
                    taskDescriptionList.appendChild(listItem);
                }
            });
            taskDescription.appendChild(taskDescriptionList);
        }

        function displayStudentTaskInfo(task) {
            clearTaskInfoContainerForStudents()
            currentTaskInstructions = task.taskInstructions;
            currentTaskId = task.assignmentId
            studentTaskGroupForStudent.innerHTML = `Užduotis: ${task.group}`;

            teacherDispalyStudentTaskIndicatorForStudent.style.display = "block";
            teacherDispalyStudentTaskIndicatorForStudent.style.backgroundColor = task.status ? greenCircleColorCode : redCircleColorCode;

            if (task.status) {
                completeTaskButton.style.display = "none"
            } else {
                completeTaskButton.style.display = "block"
            }

            if (task.result !== '') {
            score = JSON.parse(task.result)[0]
            studentScoreAnswerNumberForStudent.innerHTML = `Atsakyti klausimai: ${score[0]}`;
            studentScoreMistakeNumberForStudent.innerHTML = `Padarytos klaidos: ${score[1]}`;

            let mistakesList = [];
            mistakesList = JSON.parse(task.result)[1]
            if (mistakesList.length > 0) {
                studentMistakesTableTitleForStudent.innerHTML = "Dažniausios klaidos:"
                generateSummaryTable("custom", mistakesList, "summary-table-for-student") 
            }
            }

            const formattedTaskDescription = getOptionTextFromValues(JSON.parse(task.taskInstructions))
            taskDescriptionList = document.createElement('ul');
            taskDescriptionList.classList.add("task-description-list")
            formattedTaskDescription.forEach(item => {
                if (item) {  // Ensure empty values are not added
                    let listItem = document.createElement('li');
                    listItem.textContent = item;
                    listItem.classList.add("task-description-list-item")
                    taskDescriptionList.appendChild(listItem);
                }
            });
            let description = document.createElement('div');
            description.innerHTML = "Užduoties aprašymas:"

            taskDescriptionForStudent.appendChild(description);
            taskDescriptionForStudent.appendChild(taskDescriptionList);
            clearStudentMessage();
        }

        function populateTaskGroupDropdown() {
            const dropdown = document.getElementById("task-group-sorting");
            dropdown.innerHTML = ''; // Clear existing options

            // Create a Set to store unique task groups
            const taskGroups = new Set();

            // Iterate through students and collect unique task group names
            studentList.forEach(student => {
                student.tasks.forEach(task => {
                    taskGroups.add(task.group);
                });
            });

            // Convert Set to sorted array
            const sortedGroups = ["Visos užduočių grupės", ...Array.from(taskGroups).sort()];

            // Populate dropdown with options
            sortedGroups.forEach(group => {
                const option = document.createElement("option");
                option.value = group;
                option.textContent = group;
                dropdown.appendChild(option);
            });
        }

        function handleTaskGroupChange() {
            const dropdown = document.getElementById("task-group-sorting");
            
            dropdown.addEventListener("change", () => {
                const selectedGroup = dropdown.value;

                // Filter students based on the selected task group
                const filteredStudents = selectedGroup === "Visos užduočių grupės"
                    ? studentList
                    : studentList
                        .map(student => ({
                            ...student,
                            tasks: student.tasks.filter(task => task.group === selectedGroup)
                        }))
                        .filter(student => student.tasks.length > 0); // Remove students with no tasks after filtering

                // Re-render with the filtered student list
                renderDataForTeachers(filteredStudents);
                clearTeacherMessage();
            });
        }

        // Ensure the function runs after populating the dropdown
        handleTaskGroupChange();
        
        function renderDataForTeachers(filteredList = studentList) {
        studentListDiv.innerHTML = '';

        // Sort students alphabetically by nickname
        const sortedStudents = [...filteredList].sort((a, b) => a.nickname.localeCompare(b.nickname));

        const listContainer = document.createElement('ul');

        sortedStudents.forEach((student, studentIndex) => {
        const studentElement = document.createElement('li');
        studentElement.classList.add('student-li-item');

        // Student checkbox
        const studentCheckbox = document.createElement('input');
        studentCheckbox.type = 'checkbox';
        studentCheckbox.id = `student-${student.id}`;
        studentCheckbox.value = student.id;
        studentCheckbox.classList.add('student-checkbox');
        studentCheckbox.style.visibility = 'hidden';

        // Student label with numbering
        const studentName = document.createElement('div');
        studentName.classList.add('student-name');
        studentName.classList.add('selection-option');
        studentName.style.cursor = 'pointer';
        studentName.innerHTML = `${studentIndex + 1}. ${student.nickname} (ID: ${student.id})`;

        studentName.addEventListener('click', () => {
            // Remove 'selected-option' class from all task names
            document.querySelectorAll('.selection-option').forEach(name => {
                name.classList.remove('selected-option');
            });

            // Add 'selected-option' class to the clicked task
            studentName.classList.add('selected-option');

            // Display task info
            displayStudentStatistics([student.id, student.nickname], student.tasks);
        });

        // Student-level task status circles
        const studentCircleContainer = document.createElement('div');
        studentCircleContainer.classList.add('student-li-entry-tasks-indicatior');

        // Tasks container
        const tasksContainer = document.createElement('ul');
        tasksContainer.id = `tasks-${student.id}`;
        tasksContainer.classList.add('task-container');

        student.tasks.forEach((task, taskIndex) => {
            const taskWrapper = document.createElement('li');
            taskWrapper.classList.add('task-li-item');

            // Task checkbox
            const taskCheckbox = document.createElement('input');
            taskCheckbox.type = 'checkbox';
            taskCheckbox.id = `task-${task.assignmentId}`;
            taskCheckbox.value = task.assignmentId;
            taskCheckbox.classList.add('task-checkbox');
            taskCheckbox.style.visibility = "hidden";
            taskCheckbox.disabled = true;

            // Task label with numbering
            const taskName = document.createElement('div');
            taskName.innerHTML = `${taskIndex + 1}. ${task.group}`;
            taskName.style.cursor = 'pointer';
            taskName.classList.add('task-name');
            taskName.classList.add('selection-option');
            taskName.addEventListener('click', () => {
                // Remove 'selected-option' class from all task names
                document.querySelectorAll('.selection-option').forEach(task => {
                    task.classList.remove('selected-option');
                });

                // Add 'selected-option' class to the clicked task
                taskName.classList.add('selected-option');

                // Display task info
                displayTaskInfo([student.id, student.nickname], task);
            });

            // Task status circle
            const taskCircle = document.createElement('div');
            taskCircle.classList.add('student-list-task-indicatior');
            taskCircle.style.backgroundColor = task.status ? greenCircleColorCode : redCircleColorCode;

            // Append elements to task wrapper
            taskWrapper.appendChild(taskCheckbox);
            taskName.appendChild(taskCircle);
            taskWrapper.appendChild(taskName);

            // Append task to tasks container
            tasksContainer.appendChild(taskWrapper);
        });

        // Append elements to student element
        studentElement.appendChild(studentCheckbox);
        studentElement.appendChild(studentName);

        const outerStudentListItem = document.createElement('div');
        outerStudentListItem.classList.add('outer-student-list-entry-item');
        outerStudentListItem.appendChild(studentElement);
        outerStudentListItem.appendChild(tasksContainer);

        // Append student element to main list
        listContainer.appendChild(outerStudentListItem);
    });

    studentListDiv.appendChild(listContainer);

    if (deletingTask) {  
        document.querySelectorAll('.task-checkbox').forEach(checkbox => {
        checkbox.style.visibility = "visible";
        checkbox.disabled = false;
        });
    }
}



        function toggleTaskVisibility() {
            taskContainerVisible = !taskContainerVisible;
            if (taskContainerVisible) {
                document.querySelectorAll('.task-container').forEach(container => {
                    container.style.display = 'block';
                });
            } else {
                document.querySelectorAll('.task-container').forEach(container => {
                    container.style.display = 'none';
                });
            }
        }

        function changeTeacherToggle () {
            changingTeacher = !changingTeacher;
            if (changingTeacher) {
                changeTeacherInput.style.display = "block";
                changeTeacherButton.style.display = "block";
                teacherName.style.display = "none";
                changeTeacherToggleButton.innerHTML = "Atšaukti"
            } else {
                changeTeacherInput.style.display = "none";
                changeTeacherButton.style.display = "none";
                teacherName.style.display = "block";
                changeTeacherToggleButton.innerHTML = "Keisti mokytoją"   
            }
        }


        function renderDataForStudents() {

        if (userData.teacher === '') {
            addTeacherInput.style.display = "block";
            addTeacherButton.style.display = "block";
            changeTeacherToggleButton.style.display = "none"
        } else {
            teacherName.innerHTML = `Mok. ${userData.teacher}`
        }

            tasksList.forEach((task, taskIndex) => {
                const taskWrapper = document.createElement('li');
                taskWrapper.classList.add('task-li-item');
                taskWrapper.classList.add('task-li-item-for-students');

                // Task checkbox
                const taskCheckbox = document.createElement('input');
                taskCheckbox.type = 'checkbox';
                taskCheckbox.id = `task-${task.assignmentId}`;
                taskCheckbox.value = task.assignmentId;
                taskCheckbox.classList.add('task-checkbox');
                taskCheckbox.style.visibility = "hidden";
                taskCheckbox.disabled = true;

                // Task label with numbering
                const taskName = document.createElement('div');
                taskName.innerHTML = `${taskIndex + 1}. ${task.group}`;
                taskName.style.cursor = 'pointer';
                taskName.classList.add('task-name');
                taskName.classList.add('selection-option');
                taskName.addEventListener('click', () => {
                    // Remove 'selected-option' class from all task names
                    document.querySelectorAll('.selection-option').forEach(task => {
                        task.classList.remove('selected-option');
                    });

                    // Add 'selected-option' class to the clicked task
                    taskName.classList.add('selected-option');

                    // Display task info
                    displayStudentTaskInfo(task);
                });

                // Task status circle
                const taskCircle = document.createElement('div');
                taskCircle.classList.add('student-list-task-indicatior');
                taskCircle.style.backgroundColor = task.status ? greenCircleColorCode : redCircleColorCode;

                // Append elements to task wrapper
                //taskWrapper.appendChild(taskCheckbox);
                taskName.appendChild(taskCircle);
                taskWrapper.appendChild(taskName);

                // Append task to tasks container
                studentTasksList.appendChild(taskWrapper);
            });

            const totalTasks = tasksList.length;
            const completedTasks = tasksList.filter(task => task.status === true).length;
            if (totalTasks.length === 0) {
                taskListTitleForStudents.innerHTML = "Užduotys:"
            } else {
                taskListTitleForStudents.innerHTML = `Užduotys (atlikta ${completedTasks}/${totalTasks}):`
            }
        }




        const apiBase = 'https://sudedu-server.onrender.com/'

        async function fetchDataForTeachers() {
            try {
                const response = await fetch(apiBase + 'students', {
                    method: 'GET',
                    headers: { 'Authorization': userData.token }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                studentList = await response.json();
                populateTaskGroupDropdown();
                renderDataForTeachers();
            } catch (error) {
                console.log('Error fetching data:', error);
                teacherMessageLine.innerHTML = "Nepavyko pasiekti duomenų. Bandykite vėl vėliau."
            }
        }


        async function fetchDataForStudents() {
            try {
                const response = await fetch(apiBase + 'tasks', {
                    method: 'GET',
                    headers: { 'Authorization': userData.token }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                tasksList = await response.json();
                renderDataForStudents();

            } catch (error) {
                console.log('Error fetching tasks:', error);
                alert('Nepavyko pasiekti duomenų. Bandykite vėl vėliau.');
            }
        }
    

    function toggleAddNewTask() {
        addingNewTask = !addingNewTask
        toggleStudentListLabel();
        const dropdown = document.getElementById("task-group-sorting");
        if (addingNewTask) {
            clearTeacherMessage();
            // Set the selected option to "Visos užduočių grupės"
            dropdown.value = "Visos užduočių grupės";
            // Manually trigger the change event
            dropdown.dispatchEvent(new Event("change"));
            dropdown.disabled = true;

            toggleTaskVisibility();
            studentTaskInfoContainer.style.display = 'none'; 
            document.querySelectorAll('.student-checkbox').forEach(checkbox => {
            checkbox.style.visibility = 'visible';

            const taskGroup = document.querySelector('#task-group-sorting');
            const groupName = document.querySelector('#group_name');

            if (taskGroup && groupName) {
                groupName.style.height = `${taskGroup.offsetHeight}px`;
            }
        });
            newTaskButton.innerText = 'Atšaukti naują užduotį';
            newTaskOptions.style.display = 'block';
            deleteTaskButton.disabled = true;
            deleteStudentButton.disabled = true;
            document.querySelectorAll('.selection-option').forEach(element => {
                element.classList.add('temp-disabled');
            });
        } else {
            toggleTaskVisibility();
            studentTaskInfoContainer.style.display = 'block'; 
            document.querySelectorAll('.student-checkbox').forEach(checkbox => {
            checkbox.style.visibility = 'hidden';
            checkbox.checked = false;
        });
            newTaskButton.innerText = 'Nauja užduotis';
            newTaskOptions.style.display = 'none';
            deleteTaskButton.disabled = false;
            deleteStudentButton.disabled = false;
            dropdown.disabled = false;
            document.querySelectorAll('.selection-option').forEach(element => {
                element.classList.remove('temp-disabled');
            });
        }
    }

    function toggleDeleteTask() {
        deletingTask = !deletingTask
        toggleStudentListLabel();
        if (deletingTask) {
            clearTeacherMessage();
            confirmDeleteTaskButton.style.display = "block";       
            document.querySelectorAll('.task-checkbox').forEach(checkbox => {
            checkbox.style.visibility = "visible";
            checkbox.disabled = false;
        });
            deleteTaskButton.innerText = 'Atšaukti užduoties trinimą';
            newTaskButton.disabled = true;
            deleteStudentButton.disabled = true;
        } else {
            confirmDeleteTaskButton.style.display = "none";   
            document.querySelectorAll('.task-checkbox').forEach(checkbox => {
            checkbox.style.visibility = "hidden";
            checkbox.checked = false;
            checkbox.disabled = true;
        });
            deleteTaskButton.innerText = 'Ištrinti užduotis';
            newTaskButton.disabled = false;
            deleteStudentButton.disabled = false;
        }
    }

    function deleteSelectedTasks() {
        let tasksToRemove = [];
        document.querySelectorAll('.task-checkbox').forEach(checkbox => {
            if (checkbox.checked) {
                tasksToRemove.push(parseInt(checkbox.value));
            }
        });

        if (tasksToRemove.length === 0) {
            teacherMessageLine.innerHTML = "Pasirinkite bent vieną užduotį ištrynimui!"
            return
        }

        deleteTasks(tasksToRemove)
    }

    async function deleteAllTasks() {
        try {
                const response = await fetch(apiBase + 'tasks', {
                    method: 'GET',
                    headers: { 'Authorization': userData.token }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                const allStudentsTasks = await response.json();
                const assignmentIds = allStudentsTasks.map(task => task.assignmentId);
                deleteTasks(assignmentIds)
                
            } catch (error) {
                console.log('Error fetching tasks:', error);
                alert('Nepavyko pasiekti duomenų. Bandykite vėl vėliau.');
            }
    }


    async function deleteTasks(tasksToRemove) {

        try {
            // Prepare the list of tasks to delete (assuming tasksToTemove is already populated)
            const tasksToDelete = tasksToRemove;  // Ensure this array holds task IDs to be deleted

            deleteTaskButton.disabled = true
            confirmDeleteTaskButton.innerHTML = "Trinama..."
            const response = await fetch(apiBase + 'tasks', {
                method: 'DELETE',  // Change to DELETE method
                headers: {
                    'Authorization': userData.token,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ tasks: tasksToDelete })  // Send the list as JSON in the body
            });

            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            // Optionally, handle the response if needed (e.g., confirm deletion or update the UI)
            const result = await response.json();
            if (result.message === "Tasks and their associated assignments deleted successfully.") {
                teacherMessageLine.innerHTML = "Užduotys pašalintos sėkmingai!"
                fetchDataForTeachers()
            } else if (result.message === "An error occurred while deleting tasks.") {
                teacherMessageLine.innerHTML = "Nepavyko pašalinti užduočių. Bandykite vėl vėliau."
            }

        } catch (error) {
            console.log('Error deleting tasks:', error);
            teacherMessageLine.innerHTML = "Nepavyko pašalinti užduočių. Bandykite vėl vėliau."
        } finally {
            deleteTaskButton.disabled = false
            confirmDeleteTaskButton.innerHTML = "Trinti užduotis"
            clearTaskInfoContainer();
            toggleDeleteTask()
        }
    }

    async function setTask() {
        const selectedStudents = Array.from(document.querySelectorAll('.student-checkbox'))
            .filter(checkbox => checkbox.checked)
            .map(checkbox => parseInt(checkbox.value))

        if (selectedStudents.length === 0) {
            teacherMessageLine.innerHTML = "Pasirinkite bent vieną mokinį!"
            return
        }

        const groupName = document.getElementById('group_name').value.trim();
        const modeChoice = document.getElementById('mode_choice').value
        const modeChoice2 = document.getElementById('mode_choice_2').value
        const modeChoice3 = document.getElementById('mode_choice_3').value
        const modeChoice4 = document.getElementById('mode_choice_4').value
        const modeChoice5 = document.getElementById('mode_choice_5').value
        const modeChoice6 = document.getElementById('mode_choice_6').value
        const modeChoice7 = document.getElementById('mode_choice_7').value
        const timerInput = document.getElementById('timer-input-teacher').value
        const questionNumberInput = document.getElementById('question-number-input').value
        const remainderInput = document.getElementById('remainder-input').checked

        const selectedNumberElement = document.querySelector('#selected_number');
        const selectedNumber2Element = document.querySelector('#selected_number_2');
        let selectedNumbers = [selectedNumberElement.value, selectedNumber2Element.value].sort();

        if (groupName.length === 0) {
            teacherMessageLine.innerHTML = "Įveskite grupės pavadinimą!"
            return
        } else if (groupName.length > 15) {
            teacherMessageLine.innerHTML = "Maksimalus grupės pavadinimo ilgis yra 15 simbolių."
            return
        }

        let modeChoice3Processed;
        if (modeChoice3 === 'neper') {
            modeChoice3Processed = true;
			} else if (modeChoice3 === 'per10') {
				modeChoice3Processed = false;
			}

        let durationType;
        if (modeChoice4 === 'timer') {
            durationType = timerInput;
        } else if (modeChoice4 === 'questionNumber') {
            durationType = questionNumberInput;
        }

        const task = [
            modeChoice, modeChoice2, modeChoice3Processed, modeChoice4, 
            modeChoice5, modeChoice6, modeChoice7, selectedNumbers, 
            remainderInput, durationType
        ];

        const normalizedTask = JSON.stringify(task);

        const taskData = {
            students: selectedStudents,
            group_name: groupName,
            task: normalizedTask
        }

        submitNewTaskButton.innerHTML = "Užduodama..."
        try {
        const response = await fetch(apiBase + 'tasks', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': userData.token
            },
            body: JSON.stringify(taskData)
        });

        // First parse the response as JSON
        const responseData = await response.json();

        if (responseData.message === 'Task set successfully') {
            teacherMessageLine.innerHTML = 'Užduotis sukurta sėkmingai!'
            toggleAddNewTask();
            fetchDataForTeachers()
        } else if (responseData.message === 'Some students already have the maximum allowed tasks per student.') {
            teacherMessageLine.innerHTML = 'Galima sukurti tik vieną užduotį per mokinį. Išstrinkite seną užduotį, kad galėtumėte sukurti naują.'
        } else {
            teacherMessageLine.innerHTML = 'Nepavyko pridėti užduoties. Bandykite vėl vėliau.'
        }
        } catch (error) {
        teacherMessageLine.innerHTML = 'Nepavyko pridėti užduoties. Bandykite vėl vėliau.';
        } finally {
            submitNewTaskButton.innerHTML = "Užduoti";
        }
    }


    function completeTask() {
        const parsedCurrentTaskInstructions = JSON.parse(currentTaskInstructions);

        if (localStorage.getItem('controller') !== null) {
				controller = JSON.parse(localStorage.getItem('controller'))
			}

			var checkbox = document.getElementById("remainder-input");

			controller.language = "LT";
			controller.mode = 'math';
			controller.modeChoice = parsedCurrentTaskInstructions[0];
			controller.modeChoice2 = parsedCurrentTaskInstructions[1];
			controller.selectedNumbers = parsedCurrentTaskInstructions[7];
			controller.withRemainder = parsedCurrentTaskInstructions[8];
			controller.modeChoice3 = parsedCurrentTaskInstructions[2];
            controller.modeChoice4 = parsedCurrentTaskInstructions[3];
			controller.modeChoice5 = parsedCurrentTaskInstructions[4];
			controller.modeChoice6 = parsedCurrentTaskInstructions[5];
			controller.modeChoice7 = parsedCurrentTaskInstructions[6];
			controller.modeChoice8 = 'eeu-version';
            controller.taskId = currentTaskId;
            controller.setTaskDuration = parsedCurrentTaskInstructions[9];
			controller.result = ['', '', '', '', '']

			localStorage.setItem('controller', JSON.stringify(controller))

            startQuestions();
    }

    if (userData) {
        if (userData.accType === 'teacher') {
            teacherGUI.style.display = 'flex';
            fetchDataForTeachers();
        } else if (userData.accType === 'student') {
            studentGUI.style.display = 'flex';
            fetchDataForStudents();
        } else if (userData.accType === 'admin') {
            adminGUI.style.display = 'flex';
        }
    }

    const studentDetailsForTeachersDiv = document.querySelector('#student-details-for-teachers');
    const studentTaskInfoInnerContainer = document.querySelector('#student-task-info-container-inner');

    if (studentDetailsForTeachersDiv && studentTaskInfoInnerContainer) {
        studentTaskInfoInnerContainer.style.minHeight = `${studentDetailsForTeachersDiv.offsetHeight}px`;
    }

    const studentTaskListOuterContainer = document.querySelector('#student-tasks-list-outer-container');

    if (studentTaskListOuterContainer && dynamicStudentContent) {
        dynamicStudentContent.style.minHeight = `${studentTaskListOuterContainer.offsetHeight}px`;
    }

    async function deleteUser() {
    const usernameInput = document.getElementById('admin-remove-user-input');
    const username = usernameInput.value.trim();
    
    if (!username) {
        alert('Please enter a username');
        return;
    }
    
    try {
        // 1. Verify current user is admin
        if (userData.accType !== 'admin') {
            alert('Only admin accounts can delete users');
            return;
        }

        // 2. Get target user info
        const userResponse = await fetch(`${apiBase}auth/?username=${encodeURIComponent(username)}`, {
            headers: {
                'Authorization': userData.token
            }
        });
        
        const userInfo = await userResponse.json();
        
        if (!userInfo.id) {
            alert('User not found');
            return;
        }

        // 3. Delete user's task assignments
        if (userInfo.assignmentIds?.length > 0) {
            await deleteTasks(userInfo.assignmentIds);
        }

        // 4. Delete user and all associations
        const deleteResponse = await fetch(`${apiBase}auth/${userInfo.id}`, {
            method: 'DELETE',
            headers: {
                'Authorization': userData.token
            }
        });

        if (!deleteResponse.ok) {
            throw new Error(deleteResponse.status === 403 
                ? 'Admin privileges required' 
                : 'Failed to delete user');
        }

        alert('User deleted successfully');
        usernameInput.value = '';
        
    } catch (error) {
        console.error('Deletion error:', error);
        alert(`Error: ${error.message}`);
    }
}


	</script>
</body>

</html>
